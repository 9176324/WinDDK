
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1252">
<META NAME="Generator" CONTENT="Microsoft Word 97">
<TITLE>Kbfiltr</TITLE>
</HEAD>
<BODY LINK="#0000ff">

<FONT FACE="Verdana" SIZE=5><H2>Kbfiltr</H2>
</FONT><FONT FACE="Verdana" SIZE=2>
 
<H3>SUMMARY</H3></FONT><FONT FACE="Verdana" SIZE=2><P>
This driver filters input for a particular keyboard on the system. In its current state, it only hooks into the keyboard packet report chain, the keyboard initialization function, and the keyboard ISR, but does not do any processing of the data that it sees. (The hooking of the initialization function and ISR is only available in the i8042prt stack.)  With additions to this current filter-only code base, the filter could conceivably add, remove, or modify input as needed. <P>
This driver works on both x86 and Alpha platforms, and is 64-bit compliant.<P>
<H3>BUILDING THE SAMPLE</H3></FONT><FONT FACE="Verdana" SIZE=2><P>
This sample is installed via an .inf file. The .inf file included in this sample is designed to filter a PS/2 keyboard. <P>
Use the following rules regarding the .inf file that installs the filter driver.<P>
<li>The .inf file must install the class driver (Kbdclass) and the port driver (i8042prt, Kbdhid, etc.) by using Keyboard.inf and the INF directives "Needs" and "Include".
<li>The .inf file must add the correct registry values for the class and port driver, as well as using the new directives.</Li>

<P>The .inf (kbfiltr.inf) included in this example was generated by Geninf.exe, a tool located in the Tools directory.  An .inf file generated by Geninf.exe will contain the necessary directives to install a new keyboard filter driver. Use Geninf.exe to create the .inf file for your driver.</P>

<P>The catalog file referred to in kbfiltr.inf, Kbfiltr.cat, is included in this example, but it is <i>invalid</i>.  WHQL will provide a valid catalog file upon approval of the driver.</P>

<B>To install this filter, follow these steps:</B><P>
<OL>
<li>Open the <B>Device Manager</B>. </li>
<li>Open the <B>Properties</B> of the PS/2 keyboard installed on the system.</li>
<li>Click the <B>Driver</B> tab, and then click <B>Update Driver</B>.</li>
<li>Follow the wizard's prompts, and when prompted, select the <B>Display a list of the known drivers</B> option, and then click <B>Next</B>.</li>
<li>Click <B>Have Disk</B> and point to the location of the .inf file.</li>
<li>Proceed through the rest of the install. You will need to reboot the machine if you are filtering a PS/2 device.</li>
</OL>
Once built, the sample produces one binary: Kbfiltr.sys.<P>
The code builds properly with Microsoft&#174; Visual C&#174; 6.0 and the driver supports Plug and Play and Power Management. Both checked and free builds are available. There are no known bugs or issues to be documented.<P>
<H3>CODE TOUR</H3>
<H4>File Manifest</H4>
</FONT><U><PRE>File&#9;&#9;Description
</U>

Kbfiltr.htm&#9;The documentation for this sample (this file)
Kbfiltr.c&#9;Hooks into the reporting chain, the initialization of a PS/2 keyboard, and the PS/2 keyboard ISR
Kbfiltr.h&#9;Definitions
Kbfiltr.rc&#9;Resources
Kbfiltr.inf&#9;Sample .inf file (use geninf.exe to create your own)
Kbfiltr.cat&#9;Sample (invalid) catalog (WHQL will provide a valid catalog file upon approval)



</FONT><P ALIGN="CENTER"><A HREF="#top"><FONT FACE="Verdana" SIZE=2>Top of page</FONT></A><FONT FACE="Verdana" SIZE=2> </P></FONT>
<TABLE CELLSPACING=0 BORDER=0 WIDTH=624>
<TR><TD VALIGN="MIDDLE" BGCOLOR="#00ffff" HEIGHT=2>
<P></TD>
</TR>
</TABLE>

<FONT FACE="MS Sans Serif" SIZE=1><P>&copy; 2005 Microsoft Corporation</FONT><FONT FACE="Verdana" SIZE=2> </P></FONT></BODY>
</HTML>


