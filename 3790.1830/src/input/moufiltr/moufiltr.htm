<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="moufiltr_files/filelist.xml">
<title>Moufiltr</title>
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536871559 0 0 0 415 0;}
@font-face
	{font-family:"MS Sans Serif";
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-alt:"Times New Roman";
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:auto;
	mso-font-signature:0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
h2
	{color:black;}
h3
	{color:black;}
h4
	{color:black;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p
	{font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
pre
	{margin-top:0in;
	margin-bottom:0in;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	color:black;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:435291962;
	mso-list-template-ids:-741705326;}
@list l1
	{mso-list-id:1686593596;
	mso-list-template-ids:1385997532;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body bgcolor=white lang=EN-US link=blue vlink=purple style='tab-interval:.5in'
leftmargin=8>

<div class=Section1>

<h2><a name=MYSAMPLE></a><span class=SpellE><span style='mso-bookmark:MYSAMPLE'><span
style='font-family:Verdana'>Moufiltr</span></span></span><span
style='mso-bookmark:MYSAMPLE'></span><span style='font-family:Verdana'> <o:p></o:p></span></h2>

<h3><span style='font-family:Verdana'>SUMMARY<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>This driver filters input
for a particular mouse on the system. In its current state, it only hooks into
the mouse packet report chain and the mouse ISR, and does not do any processing
of the data that it sees. (The hooking of the ISR is only available in the
i8042prt stack.) With additions to this current filter-only code base, the
filter could conceivably add, remove, or modify input as needed. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>It works on both x86 and
Alpha platforms, and is 64-bit compliant.<o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>BUILDING THE SAMPLE<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>This sample is installed
via an .<span class=SpellE>inf</span> file. The .<span class=SpellE>inf</span>
file included in this sample is designed to filter a PS/2 mouse. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>Use the following rules
regarding the .<span class=SpellE>inf</span> file that installs the filter
driver.<o:p></o:p></span></p>

<ul type=disc>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l1 level1 lfo1;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>The .<span class=SpellE>inf</span> file must install
     the class driver (<span class=SpellE>Mouclass</span>) and the port driver
     (i8042prt, <span class=SpellE>Mouhid</span>, <span class=SpellE>Sermouse</span>,
     etc.) by using <span class=SpellE>Msmouse.inf</span> and the INF
     directives &quot;Needs&quot; and &quot;Include&quot;.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l1 level1 lfo1;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>The .<span class=SpellE>inf</span> file must add the
     correct registry values for the class and port driver, as well as using
     the new directives.<o:p></o:p></span></li>
</ul>

<p><span style='font-size:10.0pt;font-family:Verdana'>The .<span class=SpellE>inf</span>
(<span class=SpellE>moufiltr.inf</span>) included in this example was generated
by Geninf.exe, a tool located in the Tools directory. An .<span class=SpellE>inf</span>
file generated by Geninf.exe will contain the necessary directives to install a
new mouse filter driver. Use Geninf.exe to create the .<span class=SpellE>inf</span>
file for your driver.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>The catalog file referred
to in <span class=SpellE>moufiltr.inf</span>, <span class=SpellE>Kbfiltr.cat</span>,
is included in this example, but it is <i>invalid</i>. WHQL will provide a
valid catalog file upon approval of the driver.<o:p></o:p></span></p>

<p><b><span style='font-size:10.0pt;font-family:Verdana'>To install this
filter, follow these steps:<o:p></o:p></span></b></p>

<ol start=1 type=1>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>Open the <b>Device Manager</b>. <o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>Open the <b>Properties</b> of the PS/2 mouse
     installed on the system.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>Click the <b>Driver</b> tab, and then click <b>Update
     Driver</b>.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>Follow the wizard's prompts, and when prompted,
     select the <b>Display a list of the known <span class=GramE>drivers</span></b>
     option. Then click <span class=GramE><b>Next</b></span>.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>Click <b>Have Disk</b> and then point to the location
     of the .<span class=SpellE>inf</span> file.<o:p></o:p></span></li>
 <li class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
     mso-list:l0 level1 lfo2;tab-stops:list .5in'><span style='font-size:10.0pt;
     font-family:Verdana'>Proceed through the rest of the install. You will
     need to reboot the machine if you are filtering a PS/2 device.<o:p></o:p></span></li>
</ol>

<p><span style='font-size:10.0pt;font-family:Verdana'>Once built, the sample
produces one binary: <span class=SpellE>Moufiltr.sys</span>.<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>The code builds properly
with Microsoft® Visual C® 6.0 and the driver supports Plug and Play and Power
Management. Both checked and free builds are available. There are no known bugs
or issues to be documented.<o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>CODE TOUR<o:p></o:p></span></h3>

<h4><span style='font-family:Verdana'>File Manifest<o:p></o:p></span></h4>

<pre><u>File<span style='mso-tab-count:2'>           </span>Description<o:p></o:p></u></pre><pre><o:p>&nbsp;</o:p></pre><pre>Moufiltr.htm<span
style='mso-tab-count:1'>   </span>The documentation for this sample (this file).</pre><pre><span
class=SpellE>Moufiltr.c</span><span style='mso-tab-count:1'>     </span>Hooks into the reporting chain, the initialization of a PS/2 mouse, and the PS/2 ISR</pre><pre><span
class=SpellE>Moufiltr.h</span><span style='mso-tab-count:1'>     </span>Definitions</pre><pre><span
class=SpellE>Moufiltr.rc</span><span style='mso-tab-count:1'>    </span>Resources</pre><pre><span
class=SpellE>Moufiltr.inf</span><span style='mso-tab-count:1'>   </span>Sample .<span
class=SpellE>inf</span> file (use geninf.exe to create your own)</pre><pre><span
class=SpellE>Moufiltr.cat</span><span style='mso-tab-count:1'>   </span>Sample (invalid) catalog (WHQL will provide a valid catalog file upon approval)</pre><pre><o:p>&nbsp;</o:p></pre>

<p align=center style='text-align:center;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:10.0pt;font-family:"Courier New"'><a href="#top"><span
style='font-family:Verdana'>Top of page</span></a></span><span
style='font-size:10.0pt;font-family:Verdana;mso-bidi-font-family:"Courier New"'>
<o:p></o:p></span></p>

<pre><o:p>&nbsp;</o:p></pre>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=624
 style='width:6.5in;mso-cellspacing:0in'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;mso-yfti-lastrow:yes;
  height:1.5pt'>
  <td style='background:aqua;padding:.75pt .75pt .75pt .75pt;height:1.5pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
</table>

<pre><o:p>&nbsp;</o:p></pre><pre><o:p>&nbsp;</o:p></pre>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:7.5pt;font-family:"MS Sans Serif";mso-bidi-font-family:"Courier New"'>©
2004 Microsoft Corporation</span><span style='font-size:10.0pt;font-family:
Verdana;mso-bidi-font-family:"Courier New"'><o:p></o:p></span></p>

</div>

</body>

</html>

