<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="cocpyinf_files/filelist.xml">
<title>Sample Co-installer for Copying INF Files</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="State"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
[InstallA.NT.CoInstallers]<br>
AddReg = CoCopyINF.AddReg<br>
CopyFiles= CoCopyINF.CopyFiles

[CoCopyINF.AddReg]<br>
HKR,,CoInstallers32,0x10000,&quot;
cocpyinf.DLL,CoCopyINF&quot;
[CoCopyINF.CopyFiles]<br>
cocpyinf.dll,,,0x10

[DestinationDirs]<br>
CoCopyINF.CopyFiles = 11 ;
%windir%\System32


 /* Font Definitions */
 

 /* Font Definitions */
 @font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;
	mso-font-charset:0;
	mso-generic-font-family:modern;
	mso-font-format:other;
	mso-font-pitch:fixed;
	mso-font-signature:3 0 0 0 1 0;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536871559 0 0 0 415 0;}
@font-face
	{font-family:"MS Sans Serif";
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-alt:"Times New Roman";
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:auto;
	mso-font-signature:0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h2
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h3
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.5pt;
	font-family:"Times New Roman";
	font-weight:bold;}
p.MsoListBullet, li.MsoListBullet, div.MsoListBullet
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.MsoListNumber, li.MsoListNumber, div.MsoListNumber
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
p.lp1, li.lp1, div.lp1
	{mso-style-name:lp1;
	mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:-120;
	mso-list-type:simple;
	mso-list-template-ids:-1963562834;}
@list l0:level1
	{mso-level-style-link:"List Number";
	mso-level-tab-stop:.25in;
	mso-level-number-position:left;
	margin-left:.25in;
	text-indent:-.25in;}
@list l1
	{mso-list-id:-119;
	mso-list-type:simple;
	mso-list-template-ids:-5050920;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-style-link:"List Bullet";
	mso-level-text:\F0B7;
	mso-level-tab-stop:.25in;
	mso-level-number-position:left;
	margin-left:.25in;
	text-indent:-.25in;
	font-family:Symbol;}
@list l2
	{mso-list-id:498157339;
	mso-list-template-ids:1268136542;}
@list l2:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l2:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3
	{mso-list-id:604843982;
	mso-list-template-ids:1798890328;}
@list l3:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l3:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l3:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4
	{mso-list-id:1346976233;
	mso-list-template-ids:-1530385522;}
@list l4:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l4:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=EN-US link=blue vlink=blue style='tab-interval:.5in'>

<div class=Section1>

<h2><span style='font-family:Verdana'>Sample Co-installer for Copying INF Files<o:p></o:p></span></h2>

<p><b><i style='mso-bidi-font-style:normal'><span style='font-size:9.5pt;
mso-bidi-font-size:10.0pt;font-family:Arial'>Abstract: </span></i></b><span
style='font-size:10.0pt;font-family:Verdana'>This document accompanies a sample
co-installer that copies additional INF files during a device installation. These
instructions apply for the Microsoft® Windows® 2000, Windows XP, and Server
2003 operating systems. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>Note that support for the
<span class=SpellE><b>CopyINF</b></span> directive discussed in this document
is built into the Windows XP and Windows Server 2003 operating systems. <o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>SUMMARY<o:p></o:p></span></h3>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Verdana'>This
document accompanies a sample co-installer that can be used in conjunction with
an INF file to install additional device INF files on the target system during
a device installation. The instructions herein apply to the Microsoft Windows
2000 and Windows XP and Windows Server 2003 operating systems. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>The sample co-installer
described in this article interprets <span class=SpellE><b>CopyINF</b></span> directives
in a [<span class=SpellE><i>DDInstall</i></span>] section in an INF file. The
sample demonstrates using a co-installer to perform processing after a device
has been installed, parsing the INF section that is being used for the
installation, and the use of the <span class=SpellE>SetupCopyOEMInf</span>, <span
class=SpellE>SetupGetInfInformation</span>, <span class=SpellE>SetupQueryInfOriginalFileInformation</span>
and <span class=SpellE>SetupDiGetActualSectionToInstall</span> APIs. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>If you wish to use the <span
class=SpellE>CopyINF</span> directive to copy multiple INF files from a single
INF file on a target Windows® 2000 system, refer to the document on using the
redistributable CoCpyINF.DLL provided with this DDK. <o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>HOW IT WORKS<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>The co-installer is
registered as part of device installation via a [<span class=SpellE><i>DDInstall</i>.CoInstallers</span>]
section. After the co-installer has been registered, it will receive device
installation callbacks for the remainder of the install. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>When the co-installer
receives the DIF_INSTALLDEVICE callback the first time it is called
(Context-&gt;<span class=SpellE>PostProcessing</span> is FALSE), it returns a
status of ERROR_DI_POSTPROCESSING_REQUIRED. This return code causes the
co-installer to be called again once the install has been completed. The device
installation will then invoke other co-installers. The class installer or the
default installer will do the actual installation. All co-installers that
returned ERROR_DI_POSTPROCESSING_REQUIRED will then be called in reverse order,
with Context-&gt;<span class=SpellE>PostProcessing</span> set to TRUE and
Context-&gt;<span class=SpellE>InstallResult</span> specifying if the install
succeeded. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>This sample will call <span
class=SpellE>PostProcessInstallDevice</span> only if the install succeeded. If
it appears that this is a new INF file (that has not previously been copied to
the system INF directory), it will look for all <span class=SpellE>CopyINF</span>
keywords in the [<span class=SpellE><i>DDInstall</i></span>] section. For each
matching keyword, it will retrieve all the filenames to the right of the '='
and call <span class=SpellE>SetupCopyOEMInf</span> for each one. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>The syntax of the <span
class=SpellE><b>CopyINF</b></span> directive is: <o:p></o:p></span></p>

<p style='margin-left:.25in'><span style='font-size:10.0pt;font-family:Verdana'>[<span
class=SpellE><em><span style='font-family:Verdana'>DDInstall</span></em></span>]<br>
<span class=SpellE><b>CopyINF</b></span><b> =</b> <span class=SpellE><span
class=GramE><em><span style='font-family:Verdana'>filename.inf</span></em></span></span><span
class=GramE><i>[</i></span><strong><span style='font-family:Verdana'>,</span></strong><em><span
style='font-family:Verdana'>filename2.inf]</span></em>... <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>For a detailed example,
see the two co-installer sample INF files provided in the Install subdirectory.
<o:p></o:p></span></p>

<p><b><span style='font-size:10.0pt;font-family:Verdana'>Notes:</span></b><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoListBullet style='margin-left:.5in;text-indent:-.25in;mso-list:
l4 level1 lfo4;tab-stops:list .5in'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol'><span style='mso-list:Ignore'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana'>The
<span class=SpellE>CoCpyInf</span> example uses a published but previously
undocumented API: <span class=SpellE>SetupQueryInfOriginalFileInformation</span>.
This API returns the original name of an OEM INF file. <o:p></o:p></span></p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=lp1><span style='font-size:10.0pt;font-family:Verdana'>If the current
INF file name and the original INF file name are different, then the <span
class=SpellE>CoCpyInf</span> example assumes that the INF file has already been
copied and will not perform the file copies. <o:p></o:p></span></p>

<p class=lp1><span style='font-size:10.0pt;font-family:Verdana'>When a device
installation from a third-party INF occurs, that INF is copied to the system
INF directory under a unique OEM<i>&lt;n&gt;</i>.<span class=SpellE>inf</span><b>
</b>name. The sample co-installer determines whether the additional <span
class=SpellE><b>CopyINF</b></span> actions are necessary, depending on whether
the INFs original name differs from its current name. If the two names are the
same, then the INF has not yet been installed into the INF directory, so the
additional INF files are copied. If the INFs original and current names
differ, this indicates installation is from a third-party INF that already
resides in the INF directory. In that case, the additional INF copy operations
do not need to be performed, because they would have been copied previously. <o:p></o:p></span></p>

<p class=lp1><span style='font-size:10.0pt;font-family:Verdana'>Attempting to
perform the additional copies in this scenario wouldnt work anyway, because
the third-party media is no longer available. <o:p></o:p></span></p>

</blockquote>

<p class=MsoListBullet style='margin-left:.5in;text-indent:-.25in;mso-list:
l3 level1 lfo6;tab-stops:list .5in'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol'><span style='mso-list:Ignore'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:Verdana'>Note:<span
style='mso-spacerun:yes'>  </span>When creating a new public version of a
co-installer, always give it a different unique name. Once a co-installer is
installed, if it and a newer binary have the same name, the existing
co-installer may be used instead. <o:p></o:p></span></p>

<p><b><span style='font-size:10.0pt;font-family:Verdana'>Important:</span></b><span
style='font-size:10.0pt;font-family:Verdana'> The co-installer described in
this article is available as a redistributable binary in the &lt;<span
class=SpellE>ddkroot</span>&gt;\tools\<span class=SpellE>coinstallers</span>
subdirectory. If you modify this co-installer for your own use, you must give
it a new unique name. You must also change the <span class=SpellE>CopyINF</span>
directive to a different name -- such as <span class=SpellE>CopyMyINFs</span>
-- and, of course, change your co-installer to reference this new directive. <o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>BUILDING THE CO-INSTALLER SAMPLE<o:p></o:p></span></h3>

<h5><span style='font-family:Verdana'>To build the co-installer sample:<o:p></o:p></span></h5>

<p class=MsoListNumber style='margin-left:.5in;text-indent:-.25in;mso-list:
l2 level1 lfo8;tab-stops:list .5in'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Verdana;mso-fareast-font-family:Verdana;
mso-bidi-font-family:Verdana'><span style='mso-list:Ignore'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.0pt;font-family:Verdana'>Click the Free Build Environment
or Checked Build Environment icon in the Windows DDK program group to set basic
environment variables needed by Windows. <o:p></o:p></span></p>

<p class=MsoListNumber style='margin-left:.5in;text-indent:-.25in;mso-list:
l2 level1 lfo8;tab-stops:list .5in'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Verdana;mso-fareast-font-family:Verdana;
mso-bidi-font-family:Verdana'><span style='mso-list:Ignore'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.0pt;font-family:Verdana'>In a command window, change to the
directory containing the co-installer device source code. For example:<o:p></o:p></span></p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p><span class=SpellE><span class=GramE><b><span style='font-size:10.0pt;
font-family:Verdana'>cd</span></b></span></span><b><span style='font-size:10.0pt;
font-family:Verdana'> <span class=SpellE>src\setup\cocpyinf</span></span></b><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

</blockquote>

<p class=MsoListNumber style='margin-left:.5in;text-indent:-.25in;mso-list:
l2 level1 lfo8;tab-stops:list .5in'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Verdana;mso-fareast-font-family:Verdana;
mso-bidi-font-family:Verdana'><span style='mso-list:Ignore'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.0pt;font-family:Verdana'>Modify the sources file to
specify the new co-installer name. <o:p></o:p></span></p>

<p class=MsoListNumber style='margin-left:.5in;text-indent:-.25in;mso-list:
l2 level1 lfo8;tab-stops:list .5in'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Verdana;mso-fareast-font-family:Verdana;
mso-bidi-font-family:Verdana'><span style='mso-list:Ignore'>4.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span></span></span><![endif]><span
style='font-size:10.0pt;font-family:Verdana'>Use the macro BLD or run the
following from the command prompt: <o:p></o:p></span></p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p><span class=GramE><b><span style='font-size:10.0pt;font-family:Verdana'>build</span></b></span><b><span
style='font-size:10.0pt;font-family:Verdana'> c</span></b><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>This invokes the
Microsoft make routines that produce the <span class=SpellE>Build.log</span>, <span
class=SpellE>Build.wrn</span>, and <span class=SpellE>Build.err</span> log
files. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>When the build completes,
the co-installer will be placed in the Lib\I386 subdirectory of the
&lt;TARGETPATH&gt; directory specified in the Sources file. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>If the build does not
succeed, check for these errors: 1) the build environment is not set up
properly, or 2) modifications made to the sample source code introduced errors.
<o:p></o:p></span></p>

</blockquote>

<h3><span style='font-family:Verdana'>USING THE CO-INSTALLER<o:p></o:p></span></h3>

<p><b><span style='font-size:10.0pt;font-family:Verdana'>Note: </span></b><span
style='font-size:10.0pt;font-family:Verdana'>If you wish to use the unmodified
co-installer to provide the <span class=SpellE>CopyINF</span> directive on a
target Windows® 2000 system, refer to the document on using the redistributable
CoCpyINF.DLL provided with this DDK. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>To use this co-installer,
you must register it by adding a <span class=SpellE>DDInstall.CoInstallers</span>
section to the INF file for your drivers. (Note that the examples below use a
new co-installer name, &quot;<span class=SpellE>MyCoInst</span>&quot;, and
entry point, &quot;<span class=SpellE>MyEntryFunction</span>&quot;.) <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Symbol'>·</span><span
style='font-size:7.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;font-family:Verdana'>Add a [<span class=SpellE><i>DDInstall</i>.CoInstallers</span>]
section for each device specified in the INF to register the co-installer and
copy the co-installer binary. For example: <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Symbol'>·</span><span
style='font-size:7.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;font-family:Verdana'>Add an [<span class=SpellE><i>AddReg</i></span>]
section to register the co-installer. For example: <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Symbol'>·</span><span
style='font-size:7.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;font-family:Verdana'>Add a [<span class=SpellE><i>CopyFiles</i></span>]
section to copy the co-installer binary. For example: <o:p></o:p></span></p>

<p style='tab-stops:list .25in'><span style='font-size:10.0pt;font-family:Symbol'>·</span><span
style='font-size:7.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;font-family:Verdana'>Add an appropriate entry to the [<span
class=SpellE>DestinationDirs</span>] section. For example: <o:p></o:p></span></p>

<p><span class=GramE><span style='font-size:10.0pt;font-family:Symbol'>·</span><span
style='font-size:7.0pt'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;font-family:Verdana'>Add sections to install the
drivers.</span></span><span style='font-size:10.0pt;font-family:Verdana'><br>
<br>
For more information, see the sample INF files. <o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>TESTING<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>To ensure that the INF files
are not in the system, type: <o:p></o:p></span></p>

<p><st1:place w:st="on"><st1:State w:st="on"><span style='font-size:10.0pt;
  font-family:Verdana'>Del</span></st1:State></st1:place><span
style='font-size:10.0pt;font-family:Verdana'> %<span class=SpellE>windir</span>%\INF\OEM*<span
class=GramE>.?</span>NF <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>Note that this step is
safe to do only for testing purposes, and will delete any other third party INF
files that are present on the system. The system may be left in an unstable
state. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>To ensure that an older
version of the co-installer is not <span class=GramE>used,</span> type: <o:p></o:p></span></p>

<p><st1:State w:st="on"><st1:place w:st="on"><span style='font-size:10.0pt;
  font-family:Verdana'>Del</span></st1:place></st1:State><span
style='font-size:10.0pt;font-family:Verdana'> %windir%\System32\<i>YourCo-installerName</i>.dll
<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>Again, this step is safe
to do only for testing purposes. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>Uninstall the devices in
Device Manager. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>Install the devices by
clicking on the &quot;Scan for hardware changes&quot; item in the Device
Manager Action Menu. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>Once all the relevant
devices have been installed, you should check that a re-install also works.
Uninstall the devices in Device Manager again (this time without removing the
OEM*<span class=GramE>.?</span>NF files) and click on &quot;Scan for hardware
changes&quot; again. <o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>CODE TOUR<o:p></o:p></span></h3>

<h4><span style='font-family:Verdana'>File Manifest<o:p></o:p></span></h4>

<table class=MsoNormalTable border=0 cellspacing=1 cellpadding=0 width=916
 style='width:687.0pt;mso-cellspacing:.7pt;mso-padding-alt:0in 0in 0in 0in'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes'>
  <td width=151 valign=top style='width:113.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal><u>File</u></p>
  </td>
  <td width=755 style='width:566.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal><u>Description</u></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1'>
  <td width=151 valign=top style='width:113.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal><i>CoCpyInf.htm</i></p>
  </td>
  <td width=755 style='width:566.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal>Sample tour documentation for this binary (this file).</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2'>
  <td width=151 valign=top style='width:113.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal><span class=SpellE><i>Cocpyinf.c</i></span></p>
  </td>
  <td width=755 style='width:566.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal>Source file for the sample co-installer.</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:3'>
  <td width=151 valign=top style='width:113.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal><span class=SpellE><i>Cocpyinf.rc</i></span></p>
  </td>
  <td width=755 style='width:566.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal>Resource file that specifies information such as file
  type, version, and so on.</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:4'>
  <td width=151 valign=top style='width:113.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal><span class=SpellE><i>Cocpyinf.def</i></span></p>
  </td>
  <td width=755 style='width:566.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal>Definition file that lists exported APIs.</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:5'>
  <td width=151 valign=top style='width:113.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal><i>Sources</i></p>
  </td>
  <td width=755 style='width:566.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal>Generic file that lists source files and all the build
  options.</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:6'>
  <td width=151 valign=top style='width:113.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal><span class=SpellE><i>Makefile</i></span></p>
  </td>
  <td width=755 style='width:566.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal>File that redirects to the real make file that is shared
  by all the driver components of the Windows DDK.</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:7'>
  <td width=151 valign=top style='width:113.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal><i>Install\<span class=SpellE>a.inf</span></i></p>
  </td>
  <td width=755 style='width:566.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal>Sample INF file that demonstrates installation and
  registration of the co-installer together with the copying of an INF file.
  Note that this INF file is for demonstration purposes only, and will not pass
  the <span class=SpellE>ChkINF</span> utility.</p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:8;mso-yfti-lastrow:yes'>
  <td width=151 valign=top style='width:113.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal><i>Install\b.inf</i></p>
  </td>
  <td width=755 style='width:566.25pt;padding:0in 0in 0in 0in'>
  <p class=MsoNormal>Second sample INF file that demonstrates installation and
  registration of the co-installer together with the copying of an INF file.
  Note that this INF file is for demonstration purposes only, and will not pass
  the <span class=SpellE>ChkINF</span> utility.</p>
  </td>
 </tr>
</table>

<h3><span style='font-family:Courier'>FEEDBACK<o:p></o:p></span></h3>

<p><span style='font-family:Courier'>We welcome your comments, problem reports
and wish-list requests. Please submit them by pointing your Internet browser to
<a href="http://www.microsoft.com/ddk">http://www.microsoft.com/ddk</a>. </span></p>

<p align=center style='text-align:center'><span style='font-size:10.0pt;
font-family:Verdana'><a href="#top">Top of page</a><o:p></o:p></span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=624
 style='width:6.5in;mso-cellspacing:0in;mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;mso-yfti-lastrow:yes;
  height:1.5pt'>
  <td style='background:aqua;padding:.75pt .75pt .75pt .75pt;height:1.5pt'>
  <p class=MsoNormal><span style='font-size:2.0pt;mso-bidi-font-size:12.0pt'><o:p>&nbsp;</o:p></span></p>
  </td>
 </tr>
</table>

<p><span style='font-size:7.5pt;font-family:"MS Sans Serif"'>© 2004 Microsoft
Corporation </span><span style='font-size:10.0pt;font-family:Verdana'><o:p></o:p></span></p>

</div>

</body>

</html>

