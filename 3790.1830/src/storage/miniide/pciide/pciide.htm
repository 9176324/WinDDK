<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="pciide_files/filelist.xml">
<title>PCIIDE </title>
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:DisplayBackgroundShape/>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536871559 0 0 0 415 0;}
@font-face
	{font-family:"MS Sans Serif";
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-alt:"Times New Roman";
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:auto;
	mso-font-signature:0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h2
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h3
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.5pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h4
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:4;
	font-size:12.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
pre
	{margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=EN-US link=blue vlink=blue style='tab-interval:.5in'>

<div class=Section1>

<h2><span style='font-family:Verdana'>PCIIDE <o:p></o:p></span></h2>

<h3><span style='font-family:Verdana'>SUMMARY<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>This sample provides a
generic example of a PCI IDE <span class=SpellE>minidriver</span>. The sample
isolates vendor-specific code from the higher-level PCI IDE bus driver, much as
SCSI <span class=SpellE>minidrivers</span> isolate code from the SCSI port
driver. See the Release Notes section for more information. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>This sample works on both
x86, IA64, 64bit x86 and Alpha platforms. It builds with Microsoft® Visual C®
6.0. It does not implement Plug and Play or Power Management. <o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>BUILDING THE SAMPLE<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>While in the
\\Src\Storage\Miniide\Pciide directory, <span class=GramE>type <b>build</b></span>.
A successful build will produce <span class=SpellE>Pciide.sys</span>.<o:p></o:p></span></p>

<p><b><span style='font-size:10.0pt;font-family:Verdana'>Note</span></b><span
style='font-size:10.0pt;font-family:Verdana'>: The sample includes a mechanism
for specifying a callback routine that selects a transfer mode for data
transfers. If the transfer mode callback is implemented, the function is
responsible for choosing to have I/O requests passed as <span class=SpellE>busmaster</span>
(DMA transfer) or PIO (Programmed I/O).<o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>RELEASE NOTES<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>Note that the driver
model for IDE devices is different between Microsoft® Windows® 2000 and
Microsoft® Windows NT® 4.0.&nbsp; In Microsoft® Windows NT® 4.0, <span
class=SpellE>Atapi.sys</span>, a SCSI miniport driver, links to <span
class=SpellE>Scsiport.sys</span>.&nbsp; Since Windows 2000, there is still a
driver called <span class=SpellE>Atapi.sys</span>, but it is a complete port
driver. It does not link to any other driver. The new driver model isolates the
non-standard PCI IDE controller hardware interface into this PCI IDE <span
class=SpellE>minidriver</span>. <o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>RESOURCES<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>See the Kernel Mode
Drivers information in the Windows DDK documentation, specifically the sections
on storage drivers in the Design Guide and in Reference. You will also find
descriptions of the <span class=SpellE>PciIdeX</span> API's in this
documentation.<br>
<br>
Note that the <span class=SpellE>minidriver</span> cannot access the registry,
nor can it call other kernel mode APIs. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>The PCI IDE mini driver
returns its properties by using the following structure:<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>IDE_CONTROLLER_PROPERTIES
{<br>
<br>
ULONG Size; <br>
ULONG <span class=SpellE>ExtensionSize</span>; <br>
ULONG <span class=SpellE>SupportedTransferMode</span>[MAX_IDE_CHANNEL][MAX_IDE_DEVICE];
<br>
PCIIDE_CHANNEL_ENABLED <span class=SpellE>PciIdeChannelEnabled</span>; <br>
PCIIDE_SYNC_ACCESS_REQUIRED <span class=SpellE>PciIdeSyncAccessRequired</span>;
<br>
PCIIDE_TRANSFER_MODE_SELECT_FUNC <span class=SpellE>PciIdeTransferModeSelect</span>;
<br>
BOOLEAN <span class=SpellE>IgnoreActiveBitForAtaDevice</span>;<br>
BOOLEAN <span class=SpellE>AlwaysClearBusMasterInterrupt</span>;<br>
PCIIDE_USEDMA_FUNC <span class=SpellE>PciIdeUseDma</span>;<br>
ULONG <span class=SpellE>AlignmentRequirement</span>;<br>
ULONG <span class=SpellE>DefaultPIO</span>;<br>
PCIIDE_UDMA_MODES_SUPPORTED <span class=SpellE>PciIdeUdmaModesSupported</span>;<o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>} <o:p></o:p></span></p>

<h4><span style='font-family:Verdana'>Members<o:p></o:p></span></h4>

<p class=MsoNormal><b><span style='font-size:10.0pt;font-family:Verdana'>Size <o:p></o:p></span></b></p>

<p class=MsoNormal><span class=SpellE><span class=GramE><span style='font-size:
10.0pt;font-family:Verdana'>sizeof</span></span></span><span style='font-size:
10.0pt;font-family:Verdana'> (IDE_CONTROLLER_PROPERTIES).<o:p></o:p></span></p>

<p class=MsoNormal><span class=SpellE><b><span style='font-size:10.0pt;
font-family:Verdana'>ExtensionSize</span></b></span><span style='font-size:
10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Verdana'>Indicates
the amount of memory PCI IDE mini driver needs for its private data.<o:p></o:p></span></p>

<p class=MsoNormal><span class=SpellE><b><span style='font-size:10.0pt;
font-family:Verdana'>SupportedTransferMode</span></b></span><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Verdana'>Indicates
all the data transfer modes the PCI IDE controller supports.<o:p></o:p></span></p>

<p class=MsoNormal><span class=SpellE><b><span style='font-size:10.0pt;
font-family:Verdana'>PciIdeChannelEnabled</span></b></span><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoNormal><span class=GramE><span style='font-size:10.0pt;font-family:
Verdana'>Callback to query whether an IDE channel is enabled.</span></span><span
style='font-size:10.0pt;font-family:Verdana'> Note that these callbacks are
prototyped in <span class=SpellE>Ide.h</span>.<o:p></o:p></span></p>

<p class=MsoNormal><span class=SpellE><b><span style='font-size:10.0pt;
font-family:Verdana'>PciIdeSyncAccessRequired</span></b></span><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoNormal><span class=GramE><span style='font-size:10.0pt;font-family:
Verdana'>Callback to query whether both IDE channels require synchronized (one
channel at a time) access.</span></span><span style='font-size:10.0pt;
font-family:Verdana'><o:p></o:p></span></p>

<p class=MsoNormal><span class=SpellE><b><span style='font-size:10.0pt;
font-family:Verdana'>PciIdeTransferModeSelect</span></b></span><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoNormal><span class=GramE><span style='font-size:10.0pt;font-family:
Verdana'>Callback to select proper transfer modes for the given devices.</span></span><span
style='font-size:10.0pt;font-family:Verdana'><o:p></o:p></span></p>

<p class=MsoNormal><span class=SpellE><b><span style='font-size:10.0pt;
font-family:Verdana'>IgnoreActiveBitForAtaDevice</span></b></span><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Verdana'>Toggle to
ignore <span class=SpellE>busmaster</span> status active bit at the end of an
ATA data transfer. Normally, it should be FALSE.<o:p></o:p></span></p>

<p class=MsoNormal><span class=SpellE><b><span style='font-size:10.0pt;
font-family:Verdana'>AlwaysClearBusMasterInterrupt</span></b></span><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Verdana'>Toggle to
always clear the <span class=SpellE>busmaster</span> interrupt on every
interrupt generated by the device. Normally, it should be FALSE.<o:p></o:p></span></p>

<p class=MsoNormal><span class=SpellE><b><span style='font-size:10.0pt;
font-family:Verdana'>PciIdeUseDma</span></b></span><span style='font-size:10.0pt;
font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoNormal><span class=GramE><span style='font-size:10.0pt;font-family:
Verdana'>Callback to determine whether DMA should be used or not called for
every I/O.</span></span><span style='font-size:10.0pt;font-family:Verdana'><o:p></o:p></span></p>

<p class=MsoNormal><span class=SpellE><b><span style='font-size:10.0pt;
font-family:Verdana'>AlignmentRequirement</span></b></span><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoNormal><span class=GramE><span style='font-size:10.0pt;font-family:
Verdana'>Indicates if the miniport requires a different alignment.</span></span><span
style='font-size:10.0pt;font-family:Verdana'><o:p></o:p></span></p>

<p class=MsoNormal><span class=SpellE><b><span style='font-size:10.0pt;
font-family:Verdana'>DefaultPIO</span></b></span><span style='font-size:10.0pt;
font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Verdana'>Setting
this to '1' causes IO to be sent as PIO unless the user specifies otherwise.<o:p></o:p></span></p>

<p class=MsoNormal><span class=SpellE><b><span style='font-size:10.0pt;
font-family:Verdana'>PciIdeUdmaModesSupported</span></b></span><span
style='font-size:10.0pt;font-family:Verdana'> <o:p></o:p></span></p>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Verdana'>Callback that
retrieves the supported UDMA modes from the Identify data<o:p></o:p></span></p>

<h3><span style='font-family:Verdana'>CODE TOUR<o:p></o:p></span></h3>

<h4><span style='font-family:Verdana'>File Manifest<o:p></o:p></span></h4>

<pre><u>File<span style='mso-tab-count:2'>           </span>Description<o:p></o:p></u></pre><pre><o:p>&nbsp;</o:p></pre><pre><span
class=SpellE>Init.c</span><span style='mso-tab-count:2'>         </span>Main code base</pre><pre><span
class=SpellE>Pciide.h</span><span style='mso-tab-count:1'>       </span>Private <span
class=GramE>header</span> file</pre><pre><span class=SpellE>Msg.mc</span><span
style='mso-tab-count:2'>         </span>MC <span class=GramE>file</span></pre><pre><span
class=SpellE>Pciide.rc</span><span style='mso-tab-count:1'>      </span>Resource file</pre><pre><span
class=SpellE>Makefile</span><span style='mso-tab-count:1'>       </span><span
class=SpellE>Makefile</span></pre><pre>Sources<span style='mso-tab-count:2'>        </span>Sources</pre>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p align=center style='text-align:center;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:10.0pt;font-family:"Courier New"'><a href="#top"><span
style='font-family:Verdana'>Top of page</span></a></span><span
style='font-size:10.0pt;font-family:Verdana;mso-bidi-font-family:"Courier New"'>
<o:p></o:p></span></p>

<pre><o:p>&nbsp;</o:p></pre>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=624
 style='width:6.5in;mso-cellspacing:0in;mso-padding-alt:0in 5.4pt 0in 5.4pt'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;mso-yfti-lastrow:yes;
  height:1.5pt'>
  <td style='background:aqua;padding:.75pt .75pt .75pt .75pt;height:1.5pt'>
  <p class=MsoNormal><o:p>&nbsp;</o:p></p>
  </td>
 </tr>
</table>

<pre><o:p>&nbsp;</o:p></pre><pre><o:p>&nbsp;</o:p></pre>

<p style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-size:7.5pt;font-family:"MS Sans Serif";mso-bidi-font-family:"Courier New"'>©
2004 Microsoft Corporation</span><span style='font-size:10.0pt;font-family:
Verdana;mso-bidi-font-family:"Courier New"'> <o:p></o:p></span></p>

</div>

</body>

</html>

