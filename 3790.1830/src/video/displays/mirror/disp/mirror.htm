<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40"
xmlns:ns0="urn:schemas-microsoft-com:office:smarttags">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 11">
<meta name=Originator content="Microsoft Word 11">
<link rel=File-List href="Mirror_files/filelist.xml">
<title>Mirror</title>
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" LatentStyleCount="156">
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:536871559 0 0 0 415 0;}
@font-face
	{font-family:"MS Sans Serif";
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-alt:"Times New Roman";
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:auto;
	mso-font-signature:0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h2
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman";
	font-weight:bold;}
h3
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:13.5pt;
	font-family:"Times New Roman";
	font-weight:bold;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.heading2char
	{mso-style-name:heading2char;
	font-weight:bold;}
span.msodel0
	{mso-style-name:msodel;
	color:red;
	text-decoration:line-through;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:81295748;
	mso-list-template-ids:319856124;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l1
	{mso-list-id:118453527;
	mso-list-template-ids:-1432181112;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l1:level2
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level3
	{mso-level-tab-stop:1.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level4
	{mso-level-tab-stop:2.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level5
	{mso-level-tab-stop:2.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level6
	{mso-level-tab-stop:3.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level7
	{mso-level-tab-stop:3.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level8
	{mso-level-tab-stop:4.0in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l1:level9
	{mso-level-tab-stop:4.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";
	mso-ansi-language:#0400;
	mso-fareast-language:#0400;
	mso-bidi-language:#0400;}
</style>
<![endif]-->
</head>

<body lang=EN-US link=blue vlink=blue style='tab-interval:.5in'>

<div class=Section1>

<h2><span style='font-family:Verdana'>Mirror</span></h2>

<h3>SUMMARY</h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>This sample demonstrates
a driver that performs video mirroring. When video mirroring is active, each
time the system draws to the primary video device at a location inside the
mirrored area, a copy of the draw operation is executed on the mirrored video
device in real time. With this mirroring scheme, you can simultaneously draw
the same output to several video devices. Since the driver allocates memory
dynamically for targets, the number of displays that your system can support
depends on how much free memory you have at mirror-time. </span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>This sample is designed to
provide information on a standard, generic method of mirroring. This eliminates
the need for special case-by-case solutions which were used before this support
was added to the system. The sample runs on the Microsoft® Windows® 2000 and
later operating system versions, excluding Windows Me. It features commented
source code that documents in detail how the code works, to make it easy to
modify and extend. Please note that this is the first version of the video
mirror sample. Additional functionality may be added to the sample in future
releases. </span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>The sample consists of
three parts: </span></p>

<ul style='margin-top:0in' type=disc>
 <li class=MsoNormal style='mso-list:l1 level1 lfo3;tab-stops:list .5in'><span
     style='font-size:10.0pt;font-family:Verdana'>The display driver, in \%<span
     class=SpellE>Ntddk%\src\video\displays\mirror\disp</span>. </span></li>
 <li class=MsoNormal style='mso-list:l1 level1 lfo3;tab-stops:list .5in'><span
     style='font-size:10.0pt;font-family:Verdana'>The video miniport driver, in
     \%<span class=SpellE>Ntddk%\src\video\displays\mirror\mini</span>. The
     miniport driver included here is a skeleton. It simply returns success
     status for all miniport calls made by the system as there is no real
     hardware controlled by the mirror sample. </span></li>
 <li class=MsoNormal style='mso-list:l1 level1 lfo3;tab-stops:list .5in'><span
     style='font-size:10.0pt;font-family:Verdana'>An application that is a
     sample user-mode service, in \%<span class=SpellE>Ntddk%\src\video\displays\mirror\app</span>.
     </span></li>
</ul>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Verdana'>For additional
information about this sample and about mirror drivers in general, please see
the Mirror Drivers topic in the Graphics Design Guide. </span></p>

<h3><span style='font-family:Verdana'>BUILDING THE SAMPLE</span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>Install the driver by
using the included INI file, <span class=GramE>then</span> run the sample
application. After the application attaches the driver to the desktop,
mirroring will be active. At present, the sample application is a command-line
Win32 program. </span></p>

<p><b><span style='font-size:10.0pt;font-family:Verdana'>Notes</span></b><span
style='font-size:10.0pt;font-family:Verdana'>: The sample is x86 compatible. It
also compiles correctly in the 64-bit environment. All aspects of the kernel-mode
execution environment apply to the display and video miniport driver portions
of this sample. </span></p>

<h3><span style='font-family:Verdana'>INSTALLING THE SAMPLE</span></h3>

<p><span class=GramE><span style='font-size:10.0pt;font-family:Verdana'>To
install the sample, copy <i>mirror.dll</i> to %winnt%\system32, and copy <span
class=SpellE><i>mirror.sys</i></span> to %winnt%\system32\drivers.</span></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>The included INF file, <span
class=SpellE><i>mirror.inf</i></span>, makes the following changes to the
registry, under the <b>HKLM\SYSTEM\<span class=SpellE>CurrentControlSet</span>\Services\mirror</b>
key. In the following, '#' is the device number.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Device#\Device Description &quot;Microsoft Mirror Driver&quot; (SZ)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Device#\<span class=SpellE>InstalledDisplayDrivers</span> &quot;mirror&quot;
(MULTI_SZ)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Device#\<span class=SpellE>MirrorDriver</span> 0x1 (DWORD)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Device#\xxx possibly other keys<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span class=SpellE>Enum</span>\xxx keys for enumerating devices</span></p>

<h3><span style='font-family:Verdana'>RUNNING THE SAMPLE</span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>Here is a list of common
tasks you can perform when you run the mirrored driver on a mirrored device:</span></p>

<p><b><span style='font-size:10.0pt;font-family:Verdana'>Change the mirrored
device settings</span></b></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>To change the settings
for your mirrored device, you must know the '\\.\DISPLAY#' name<br>
associated with your mirrored display. In the case of multiple instances of
display adapters, '#' represents different numbers. These names can be found by
iterating through the available display devices using <span class=SpellE><b>EnumDisplayDevices</b></span>.
For reference/testing only, this information can be<br>
found under the following key:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>HKLM\HARDWARE\<span class=SpellE>DeviceMap</span>\Video</b><br>
<br>
<b>Attach the mirrored device to the desktop <span class=SpellE>pdev</span>
list</b></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>To attach the mirrored
device to the desktop <span class=SpellE>pdev</span> list, add a registry value<br>
<span class=SpellE><b>Attach.ToDesktop</b></span> = 0x1. Subsequent calls to <span
class=SpellE><b>ChangeDisplaySettings</b></span> will then dynamically load the
mirrored display driver for use.<br>
<br>
<b>HKLM\SYSTEM\<span class=SpellE>CurrentControlSet</span>\Hardware
Profiles\Current\System\<span class=SpellE>CurrentControlSet</span>\<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Services\mirror</b> [<i>where
'mirror' is short name of mirrored surface</i>]<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <b>Device#\<span
class=SpellE>Attach.ToDesktop</span></b> 0x1 (DWORD<span class=GramE>)</span><br>
<br>
<b>Detach the mirrored device from the desktop <span class=SpellE>pdev</span>
list</b></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>To disable the attachment
to the desktop <span class=SpellE>pdev</span> list, set <span class=SpellE><b>Attach.ToDesktop</b></span>
to 0x0. If you do not detach the mirrored device from the desktop <span
class=SpellE>pdev</span> list, your driver will be invoked again the next time
the system boots. To save the other <span class=SpellE><b>Default.Settings</b></span>
values saved under this key, call <span class=SpellE><b>ChangeDisplaySettings</b></span>
with <span class=SpellE><i>dwFlags</i></span> set to CDS_UPDATEREGISTRY.<br>
<br>
<b>Create a DC or device-managed bitmap</b></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>To create a DC, device-managed
bitmap, etc. using the mirrored surface, use the<br>
ordinary GDI APIs. To create the DC specify, call <span class=SpellE><b>CreateDC</b></span>
as follows<span class=GramE>:</span><br>
<br>
HDC <span class=SpellE>hdc</span> = <span class=SpellE>CreateDC</span>(&quot;DISPLAY&quot;,
// driver name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<span class=SpellE>deviceName</span>, // example 'mirror' device name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
NULL,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp; NULL);<br>
<br>
See the DDK sample for a working demonstration.</span></p>

<h3><span style='font-family:Verdana'>MIRROR DISPLAY DRIVER REQUIREMENTS</span></h3>

<p style='margin-bottom:12.0pt'><span style='font-size:10.0pt;font-family:Verdana'>A
mirrored display driver must implement at least the following functions<span
class=GramE>:</span><br>
<br>
<span class=SpellE><b>DrvEnableDriver</b></span> [exported]<br>
<span class=SpellE><b>DrvEnablePDEV</b></span><br>
<span class=SpellE><b>DrvCompletePDEV</b></span><br>
<span class=SpellE><b>DrvDisablePDEV</b></span><br>
<span class=SpellE><b>DrvEnableSurface</b></span><br>
<span class=SpellE><b>DrvDisableSurface</b></span><br>
<span class=SpellE><b>DrvBitBlt</b></span><br>
<span class=SpellE><b>DrvCopyBits</b></span><br>
<span class=SpellE><b>DrvCreateDeviceBitmap</b></span><br>
<span class=SpellE><b>DrvDeleteDeviceBitmap</b></span><br>
<span class=SpellE><b>DrvTextOut</b></span></span></p>

<h3><span style='font-family:Verdana'>MIRROR MINIPORT DRIVER REQUIREMENTS</span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>A mirrored miniport
driver must implement at least the following functions:</span></p>

<p><span class=SpellE><b><span style='font-size:10.0pt;font-family:Verdana'>DriverEntry</span></b></span><span
style='font-size:10.0pt;font-family:Verdana'> [exported<span class=GramE>]</span><br>
<span class=SpellE><i>HwVidFindAdapter</i></span><br>
<span class=SpellE><i>HwVidInitialize</i></span><br>
<span class=SpellE><i>HwVidStartIO</i></span><br>
<br>
Because there is no physical display device associated with a mirrored surface,
these routines can return positive results.</span></p>

<p align=center style='text-align:center'><a
href="file:///\\winbuilds\release\lab02\release\x86fre\4093.x86fre.lab02_n.041002-1235\ddk_flat\src\video\displays\mirror\disp\mirror.htm#top"><span
style='font-size:10.0pt;font-family:Verdana'>Top of page</span></a><span
style='font-size:10.0pt;font-family:Verdana'> </span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=624
 style='width:6.5in;mso-cellspacing:0in;mso-padding-alt:0in 0in 0in 0in'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;mso-yfti-lastrow:yes;
  height:1.5pt'>
  <td style='background:aqua;padding:.75pt .75pt .75pt .75pt;height:1.5pt'>
  <p class=MsoNormal><span style='font-size:2.0pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p><span style='font-size:7.5pt;font-family:"MS Sans Serif"'>© 2004 Microsoft
Corporation</span></p>

</div>

</body>

</html>

