<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="readme_files/filelist.xml">
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>ervinp</o:Author>
  <o:LastAuthor>ervinp</o:LastAuthor>
  <o:Revision>12</o:Revision>
  <o:TotalTime>56</o:TotalTime>
  <o:Created>2003-01-24T20:48:00Z</o:Created>
  <o:LastSaved>2003-01-24T21:44:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>454</o:Words>
  <o:Characters>2590</o:Characters>
  <o:Company>Microsoft Corporation</o:Company>
  <o:Lines>21</o:Lines>
  <o:Paragraphs>6</o:Paragraphs>
  <o:CharactersWithSpaces>3038</o:CharactersWithSpaces>
  <o:Version>10.3501</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:SpellingState>Clean</w:SpellingState>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:1045174524;
	mso-list-type:hybrid;
	mso-list-template-ids:-1727499302 1386377632 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:1.25in;
	mso-level-number-position:left;
	margin-left:1.25in;
	text-indent:-.25in;
	font-family:Symbol;
	mso-fareast-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
</style>
<![endif]-->
</head>

<body lang=EN-US style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>The FILTER
sample has been removed from the Windows Server 2003 DDK.<span
style='mso-spacerun:yes'>  </span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='text-indent:.5in'>For an example of a WDM filter
driver, see the <i style='mso-bidi-font-style:normal'>Toaster</i> sample.<span
style='mso-spacerun:yes'>  </span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span>For those
using the FILTER sample from a previous DDK release, please note the following
issues concerning that sample:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span><u>General
issues</u>:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:1.25in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list 1.25in'><![if !supportLists]><span style='font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>In the <span class=SpellE>IoCreateDevice</span>
call, should pass FILE_DEVICE_SECURE_OPEN for the <span class=SpellE><i
style='mso-bidi-font-style:normal'>DeviceCharacteristics</i></span> parameter.<span
style='mso-spacerun:yes'>  </span>This instructs the I/O manager to perform
security checks for all opens on the device.</p>

<p class=MsoNormal style='margin-left:1.25in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list 1.25in'><![if !supportLists]><span style='font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>Should check for NULL result after returning
from the <span class=SpellE>IoAttachDeviceToDeviceStack</span> call.<span
style='mso-spacerun:yes'>  </span>If NULL was returned, should free the new
filter device object and return STATUS_UNSUCCESSFUL.</p>

<p class=MsoNormal style='margin-left:1.25in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list 1.25in'><![if !supportLists]><span style='font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>In <span class=SpellE>VA_AddDevice</span>, after
creating the filter device object, should propagate all device characteristics
from the lower device; i.e. <span class=SpellE><span style='font-size:10.0pt'>filterDevObj</span></span><span
style='font-size:10.0pt'>-&gt;Characteristics = <span class=SpellE>devExt</span>-&gt;<span
class=SpellE>topDevObj</span>-&gt;Characteristics;</span><span
style='mso-spacerun:yes'>  </span>.</p>

<p class=MsoNormal style='margin-left:1.25in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list 1.25in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>In <span class=SpellE>VA_AddDevice</span>, after
creating the filter device object, should propagate device flags from the lower
device as follows: <span class=SpellE><span style='font-size:10.0pt'>filterDevObj</span></span><span
style='font-size:10.0pt'>-&gt;Flags |= (<span class=SpellE>devExt</span>-&gt;<span
class=SpellE>topDevObj</span>-&gt;Flags &amp; (DO_POWER_INRUSH | DO_POWER_PAGABLE
| DO_BUFFERED_IO | DO_DIRECT_IO));<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.25in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list 1.25in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>The power handler, <span class=SpellE>VA_Power</span>,
was declared as pageable and there is special code in the previous sample to
lock the code when needed.<span style='mso-spacerun:yes'>  </span>It is
recommended that power handlers always be declared as locked (i.e. remove the #<span
class=SpellE>pragma</span> declaring it as paged) due to the many issues that pageable
power handlers create, thus removing the need for the <span class=SpellE>MmLockPageableCodeSection/MmUnlockPageableImageSection</span>
calls and related code.<span style='mso-spacerun:yes'>  </span>Even when the
power handler is always locked, however, it is still required that the driver clear
and reset the DO_POWER_PAGABLE bit in the device flags appropriately when
receiving the <span class=SpellE>DeviceUsageTypePaging</span>
notification.<span style='mso-spacerun:yes'>  </span><span style='font-size:
10.0pt'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.25in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list 1.25in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>For the IRP_MN_QUERY_PNP_DEVICE_STATE handling
code, the PNP_DEVICE_NOT_DISABLEABLE should be set when any of the {paging/hibernate/crashdump}path
counts are non-zero, and cleared when those path counts are all zero.<span
style='font-size:10.0pt'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.25in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list 1.25in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>The <span class=SpellE>DeviceUsageNotification</span>
code should always be included, even for non-storage devices (i.e. always
define HANDLE_DEVICE_USAGE in <span class=SpellE>filter.h</span>).<span
style='mso-spacerun:yes'>  </span>This is because a storage device may be
enumerated on top of a non-storage device, and the special power and other
handling activated by the path counts needs to be in effect all the way down to
the hardware.<span style='font-size:10.0pt'><o:p></o:p></span></p>

<p class=MsoNormal><span style='mso-tab-count:1'>            </span></p>

<p class=MsoNormal style='text-indent:.5in'><u>Issues for storage driver stacks</u>
(for filter drivers that may attach to storage device drivers):</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='margin-left:1.25in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list 1.25in'><![if !supportLists]><span style='font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>In the <span class=SpellE>IoCreateDevice</span>
call, should pass <span class=SpellE>physicalDevObj</span>-&gt;<span
class=SpellE>DeviceType</span> for the <span class=SpellE><i style='mso-bidi-font-style:
normal'>DeviceType</i></span> parameter if ever attaching as an upper storage
filter on Windows 2000.<span style='mso-spacerun:yes'>  </span>This works
around a problem in Windows 2000 which causes the mount mappings to be
determined from only the top driver in the device stack.</p>

<p class=MsoNormal style='margin-left:1.25in;text-indent:-.25in;mso-list:l0 level1 lfo1;
tab-stops:list 1.25in'><![if !supportLists]><span style='font-size:10.0pt;
font-family:Symbol;mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]>In the code handling IRP_MN_START_DEVICE, propagate
the FILE_REMOVABLE_MEDIA characteristic in case the lower driver has set this
bit in its start handler (thus requiring restricted use of caching by the file
system), i.e.: <span class=SpellE><span style='font-size:10.0pt'>devExt</span></span><span
style='font-size:10.0pt'>-&gt;<span class=SpellE>filterDevObj</span>-&gt;Characteristics
|= (<span class=SpellE>devExt</span>-&gt;<span class=SpellE>topDevObj</span>-&gt;Characteristics
&amp; FILE_REMOVABLE_MEDIA); .<o:p></o:p></span></p>

<p class=MsoNormal style='margin-left:1.0in'><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>

