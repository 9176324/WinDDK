<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 12">
<meta name=Originator content="Microsoft Word 12">
<link rel=File-List href="toaster_files/filelist.xml">
<title>Toaster</title>
<link rel=themeData href="toaster_files/themedata.thmx">
<link rel=colorSchemeMapping href="toaster_files/colorschememapping.xml">
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:GrammarState>Clean</w:GrammarState>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>EN-US</w:LidThemeOther>
  <w:LidThemeAsian>X-NONE</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:DontGrowAutofit/>
   <w:SplitPgBreakAndParaMark/>
   <w:DontVertAlignCellWithSp/>
   <w:DontBreakConstrainedForcedTables/>
   <w:DontVertAlignInTxbx/>
   <w:Word11KerningPairs/>
   <w:CachedColBalance/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="true"
  DefSemiHidden="true" DefQFormat="false" DefPriority="99"
  LatentStyleCount="267">
  <w:LsdException Locked="false" Priority="0" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" Name="toc 9"/>
  <w:LsdException Locked="false" Priority="35" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" Priority="10" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" Priority="1" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" Priority="11" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" Priority="22" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" Priority="59" SemiHidden="false"
   UnhideWhenUsed="false" Name="Table Grid"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" UnhideWhenUsed="false" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" SemiHidden="false"
   UnhideWhenUsed="false" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" SemiHidden="false"
   UnhideWhenUsed="false" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" SemiHidden="false"
   UnhideWhenUsed="false" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" SemiHidden="false"
   UnhideWhenUsed="false" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="false"
   UnhideWhenUsed="false" QFormat="true" Name="TOC Heading"/>
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1610611985 1107304683 0 0 415 0;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-pitch:variable;
	mso-font-signature:-1610611985 1073741899 0 0 415 0;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-520092929 1073786111 9 0 415 0;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-520081665 -1073717157 41 0 66047 0;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;
	mso-font-charset:0;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-1593833729 1073750107 16 0 415 0;}
@font-face
	{font-family:Consolas;
	panose-1:2 11 6 9 2 2 4 3 2 4;
	mso-font-charset:0;
	mso-generic-font-family:modern;
	mso-font-pitch:fixed;
	mso-font-signature:-520092929 1073806591 9 0 415 0;}
@font-face
	{font-family:"MS Sans Serif";
	panose-1:0 0 0 0 0 0 0 0 0 0;
	mso-font-alt:"Times New Roman";
	mso-font-charset:0;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:auto;
	mso-font-signature:0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-parent:"";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
h1
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Heading 1 Char";
	margin-top:24.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:"Times New Roman";
	font-weight:bold;}
h2
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Heading 2 Char";
	margin-top:10.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:13.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:"Times New Roman";
	font-weight:bold;}
h3
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Heading 3 Char";
	margin-top:10.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:111%;
	mso-pagination:widow-orphan;
	mso-outline-level:3;
	font-size:11.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:"Times New Roman";
	font-weight:bold;}
h4
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Heading 4 Char";
	margin-top:10.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	mso-outline-level:4;
	font-size:11.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:"Times New Roman";
	font-weight:bold;
	font-style:italic;}
h5
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Heading 5 Char";
	margin-top:10.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	mso-outline-level:5;
	font-size:11.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:"Times New Roman";
	color:#7F7F7F;
	font-weight:bold;}
h6
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Heading 6 Char";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:111%;
	mso-pagination:widow-orphan;
	mso-outline-level:6;
	font-size:11.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:"Times New Roman";
	color:#7F7F7F;
	font-weight:bold;
	font-style:italic;}
p.MsoHeading7, li.MsoHeading7, div.MsoHeading7
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Heading 7 Char";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	mso-outline-level:7;
	font-size:11.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:Calibri;
	font-style:italic;}
p.MsoHeading8, li.MsoHeading8, div.MsoHeading8
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Heading 8 Char";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	mso-outline-level:8;
	font-size:10.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:Calibri;}
p.MsoHeading9, li.MsoHeading9, div.MsoHeading9
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Heading 9 Char";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	mso-outline-level:9;
	font-size:10.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:Calibri;
	letter-spacing:.25pt;
	font-style:italic;}
p.MsoCommentText, li.MsoCommentText, div.MsoCommentText
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-link:"Comment Text Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:normal;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{mso-style-priority:10;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Title Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:normal;
	mso-pagination:widow-orphan;
	font-size:26.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:Calibri;
	letter-spacing:.25pt;}
p.MsoSubtitle, li.MsoSubtitle, div.MsoSubtitle
	{mso-style-priority:11;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Subtitle Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:30.0pt;
	margin-left:0in;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:Calibri;
	letter-spacing:.65pt;
	font-style:italic;}
a:link, span.MsoHyperlink
	{mso-style-noshow:yes;
	mso-style-priority:99;
	color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-noshow:yes;
	mso-style-priority:99;
	color:purple;
	text-decoration:underline;
	text-underline:single;}
em
	{mso-style-priority:20;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	letter-spacing:.5pt;
	border:none windowtext 1.0pt;
	mso-border-alt:none windowtext 0in;
	padding:0in;
	font-weight:bold;}
p
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-margin-top-alt:auto;
	margin-right:0in;
	mso-margin-bottom-alt:auto;
	margin-left:0in;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
pre
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-link:"HTML Preformatted Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	mso-pagination:widow-orphan;
	tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
p.MsoCommentSubject, li.MsoCommentSubject, div.MsoCommentSubject
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-link:"Comment Subject Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:normal;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	font-weight:bold;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-link:"Balloon Text Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:8.0pt;
	font-family:"Tahoma","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
p.MsoNoSpacing, li.MsoNoSpacing, div.MsoNoSpacing
	{mso-style-priority:1;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	margin:0in;
	margin-bottom:.0001pt;
	line-height:normal;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
p.MsoRMPane, li.MsoRMPane, div.MsoRMPane
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{mso-style-priority:34;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:.5in;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
p.MsoQuote, li.MsoQuote, div.MsoQuote
	{mso-style-priority:29;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Quote Char";
	margin-top:10.0pt;
	margin-right:.25in;
	margin-bottom:0in;
	margin-left:.25in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	font-style:italic;}
p.MsoIntenseQuote, li.MsoIntenseQuote, div.MsoIntenseQuote
	{mso-style-priority:30;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Intense Quote Char";
	margin-top:10.0pt;
	margin-right:.8in;
	margin-bottom:14.0pt;
	margin-left:.7in;
	text-align:justify;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	font-weight:bold;
	font-style:italic;}
span.MsoSubtleEmphasis
	{mso-style-priority:19;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	font-style:italic;}
span.MsoIntenseEmphasis
	{mso-style-priority:21;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	font-weight:bold;}
span.MsoSubtleReference
	{mso-style-priority:31;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	font-variant:small-caps;}
span.MsoIntenseReference
	{mso-style-priority:32;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	font-variant:small-caps;
	letter-spacing:.25pt;
	text-decoration:underline;
	text-underline:single;}
span.MsoBookTitle
	{mso-style-priority:33;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	font-variant:small-caps;
	letter-spacing:.25pt;
	font-style:italic;}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{mso-style-priority:39;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	margin-top:24.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:Calibri;
	font-weight:bold;}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Heading 1";
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-hansi-font-family:Cambria;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Heading 2";
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-hansi-font-family:Cambria;
	font-weight:bold;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Heading 3";
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-hansi-font-family:Cambria;
	font-weight:bold;}
span.Heading4Char
	{mso-style-name:"Heading 4 Char";
	mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Heading 4";
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-hansi-font-family:Cambria;
	font-weight:bold;
	font-style:italic;}
span.Heading5Char
	{mso-style-name:"Heading 5 Char";
	mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Heading 5";
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-hansi-font-family:Cambria;
	color:#7F7F7F;
	font-weight:bold;}
span.Heading6Char
	{mso-style-name:"Heading 6 Char";
	mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Heading 6";
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-hansi-font-family:Cambria;
	color:#7F7F7F;
	font-weight:bold;
	font-style:italic;}
span.HTMLPreformattedChar
	{mso-style-name:"HTML Preformatted Char";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"HTML Preformatted";
	font-family:Consolas;
	mso-ascii-font-family:Consolas;
	mso-hansi-font-family:Consolas;
	mso-bidi-font-family:Consolas;}
span.Heading7Char
	{mso-style-name:"Heading 7 Char";
	mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Heading 7";
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-hansi-font-family:Cambria;
	font-style:italic;}
span.Heading8Char
	{mso-style-name:"Heading 8 Char";
	mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Heading 8";
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-hansi-font-family:Cambria;}
span.Heading9Char
	{mso-style-name:"Heading 9 Char";
	mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Heading 9";
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-hansi-font-family:Cambria;
	letter-spacing:.25pt;
	font-style:italic;}
span.CommentTextChar
	{mso-style-name:"Comment Text Char";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Comment Text";
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-hansi-font-family:Calibri;
	mso-bidi-font-family:Calibri;}
span.TitleChar
	{mso-style-name:"Title Char";
	mso-style-priority:10;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:Title;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-hansi-font-family:Cambria;
	letter-spacing:.25pt;}
p.msotitlecxspfirst, li.msotitlecxspfirst, div.msotitlecxspfirst
	{mso-style-name:msotitlecxspfirst;
	mso-style-unhide:no;
	mso-style-link:"Title Char";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:normal;
	mso-pagination:widow-orphan;
	font-size:26.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:Calibri;
	letter-spacing:.25pt;}
p.msotitlecxspmiddle, li.msotitlecxspmiddle, div.msotitlecxspmiddle
	{mso-style-name:msotitlecxspmiddle;
	mso-style-unhide:no;
	mso-style-link:"Title Char";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:normal;
	mso-pagination:widow-orphan;
	font-size:26.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:Calibri;
	letter-spacing:.25pt;}
p.msotitlecxsplast, li.msotitlecxsplast, div.msotitlecxsplast
	{mso-style-name:msotitlecxsplast;
	mso-style-unhide:no;
	mso-style-link:"Title Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:normal;
	mso-pagination:widow-orphan;
	font-size:26.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:Calibri;
	letter-spacing:.25pt;}
span.SubtitleChar
	{mso-style-name:"Subtitle Char";
	mso-style-priority:11;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:Subtitle;
	font-family:"Cambria","serif";
	mso-ascii-font-family:Cambria;
	mso-hansi-font-family:Cambria;
	letter-spacing:.65pt;
	font-style:italic;}
span.CommentSubjectChar
	{mso-style-name:"Comment Subject Char";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Comment Subject";
	font-family:"Calibri","sans-serif";
	mso-ascii-font-family:Calibri;
	mso-hansi-font-family:Calibri;
	mso-bidi-font-family:Calibri;
	font-weight:bold;}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Balloon Text";
	font-family:"Tahoma","sans-serif";
	mso-ascii-font-family:Tahoma;
	mso-hansi-font-family:Tahoma;
	mso-bidi-font-family:Tahoma;}
p.msolistparagraphcxspfirst, li.msolistparagraphcxspfirst, div.msolistparagraphcxspfirst
	{mso-style-name:msolistparagraphcxspfirst;
	mso-style-unhide:no;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
p.msolistparagraphcxspmiddle, li.msolistparagraphcxspmiddle, div.msolistparagraphcxspmiddle
	{mso-style-name:msolistparagraphcxspmiddle;
	mso-style-unhide:no;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
p.msolistparagraphcxsplast, li.msolistparagraphcxsplast, div.msolistparagraphcxsplast
	{mso-style-name:msolistparagraphcxsplast;
	mso-style-unhide:no;
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:.5in;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
span.QuoteChar
	{mso-style-name:"Quote Char";
	mso-style-priority:29;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:Quote;
	font-style:italic;}
span.IntenseQuoteChar
	{mso-style-name:"Intense Quote Char";
	mso-style-priority:30;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-link:"Intense Quote";
	font-weight:bold;
	font-style:italic;}
p.msotocheadingcxspfirst, li.msotocheadingcxspfirst, div.msotocheadingcxspfirst
	{mso-style-name:msotocheadingcxspfirst;
	mso-style-unhide:no;
	margin-top:24.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:Calibri;
	font-weight:bold;}
p.msotocheadingcxspmiddle, li.msotocheadingcxspmiddle, div.msotocheadingcxspmiddle
	{mso-style-name:msotocheadingcxspmiddle;
	mso-style-unhide:no;
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:Calibri;
	font-weight:bold;}
p.msotocheadingcxsplast, li.msotocheadingcxsplast, div.msotocheadingcxsplast
	{mso-style-name:msotocheadingcxsplast;
	mso-style-unhide:no;
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;
	mso-bidi-font-family:Calibri;
	font-weight:bold;}
p.msopapdefault, li.msopapdefault, div.msopapdefault
	{mso-style-name:msopapdefault;
	mso-style-unhide:no;
	mso-margin-top-alt:auto;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";
	mso-fareast-font-family:"Times New Roman";
	mso-fareast-theme-font:minor-fareast;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
.MsoChpDefault
	{mso-style-type:export-only;
	mso-default-props:yes;
	font-size:10.0pt;
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;}
.MsoPapDefault
	{mso-style-type:export-only;
	margin-bottom:10.0pt;
	line-height:115%;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:940337462;
	mso-list-template-ids:-77270206;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-qformat:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin-top:0in;
	mso-para-margin-right:0in;
	mso-para-margin-bottom:10.0pt;
	mso-para-margin-left:0in;
	line-height:115%;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US link=blue vlink=purple style='tab-interval:.5in'>

<div class=Section1>

<h1><span style='mso-fareast-font-family:"Times New Roman"'>Toaster - Driver
Learning Package<o:p></o:p></span></h1>

<p class=MsoNormal>(WDM Version)</p>

<p><a href="#sum"><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>Summary</span></a><span style='font-size:10.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'><br>
</span><a href="#intro"><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Introduction to WDM Driver Model</span></a><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'><br>
</span><a href="#toast"><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Introduction to the Toaster Sample </span></a><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'><br>
</span><a href="#build"><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Building the sample</span></a><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'><br>
</span><a href="#install"><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Installation</span></a><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'><br>
</span><a href="#test"><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Testing</span></a><span style='font-size:
10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'><br>
</span><a href="#filter"><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Filters</span></a><span style='font-size:
10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'><br>
</span><a href="#params"><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Device Parameters Subkey</span></a><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'><br>
</span><a href="#power"><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Power Management</span></a><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'><br>
</span><a href="#wmi"><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>WMI</span></a><span style='font-size:10.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'><br>
</span><a href="#etw"><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Event Tracing</span></a><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'><br>
</span><a href="#tmon"><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Toastmon</span></a><span style='font-size:
10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'><br>
</span><a href="toastpkg/toastpkg.htm"><span style='font-size:10.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>Toaster Installation
Package</span></a></p>

<h3><a name=sum></a><span style='font-family:"Verdana","sans-serif";mso-fareast-font-family:
"Times New Roman"'>Summary</span><span style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>The
Toaster sample provides a starting point for Windows® driver development. It contains
annotated code to illustrate the functionality of bus driver, function driver,
assorted class, device, and bus filter drivers, class-installer, and
device-specific co-installer for a hypothetical Toaster bus and its devices. </span></p>

<h3><a name=intro></a><span style='font-family:"Verdana","sans-serif";
mso-fareast-font-family:"Times New Roman"'>Introduction to WDM Driver Model</span><span
style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Every
device driver stack for a Plug and Play (PnP) device under the Microsoft®
Windows® 2000 and later operating system typically comprises a bus driver, a
function driver, and from zero to one or more filter drivers. These drivers must
support Plug and Play, Power Management, and Windows Management Instrumentation
(WMI) to provide a better user experience and greater satisfaction. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>These
buzzwords make sense if you have developed a driver for Windows 95 or Windows
98. But, a developer who has only worked on Windows NT® drivers might wonder:
What are these things? Why do I need to worry about them? How do I implement
them? </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Imagine
a system with a new type of PnP I/O bus called a toaster bus. A controller chip
on the motherboard initializes and manages the bus. The bus has a couple of
ports jutting out of the box into which you can plug your toasters. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>To
provide support for this bus on Windows NT 4.0, you must modify the HAL
(hardware abstraction layer) to recognize and initialize the I/O bus during
system boot and you must provide a set of HAL functions for scanning the bus
and accessing the configuration space of the devices by other drivers. Next,
you must write drivers for every type of toaster device that load along with
the system, and then use the exported HAL functions to scan the bus to detect
the device, read the I/O resource requirements, and configure and initialize
the device. These drivers are loaded regardless of whether or not a particular
toaster is plugged in. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>If
another driver requires the I/O resources claimed by your driver, there is no
resource distribution mechanism on Windows NT 4.0 to instruct the driver to
relinquish them and use other resources if possible. If you want to expose
instrumentation data or report some exceptional events to user mode, you must
provide your own interface and custom applications. There is no generic
interface like WMI and no power management. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>To
support this bus and its devices under Windows 2000 and later OS, however, you
don’t have to modify the HAL or export a new set of functions. All you need to
do is write a bus driver that has knowledge of bus architecture, identifies
(enumerates) devices on the bus, reads their resource requirements, and
configures them. This driver model also makes the operating system independent
of its I/O bus. This means you don’t need help from Microsoft if you design a
new I/O bus to modify the HAL. Then, you write function drivers to control
individual devices connected to the bus. Later on, one can write one or more
filter drivers to add or modify the features supported by bus, a specific
device or class of devices. There can be any number of lower-level or
upper-level filter drivers for a bus, a device, or a class of devices. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>The
Windows Driver Kit documentation explains these new concepts and features by
providing background information and describing how to implement them in your
driver(s). This article and the accompanying sample <span class=GramE>drivers</span>
package provide annotated code samples that illustrate the functionality of
various drivers without getting into detailed hardware specifics. These samples
will help you start coding right away. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>To
make the sample code closer to a real-world driver, I have defined a new class
of devices called the TOASTER class and wrote a bus driver, function driver,
and all possible class, device, and bus filter drivers for this hypothetical
TOASTER bus and its devices. I have also provided a sample of coinstaller DLL
to show how you can parse a custom section from an INF file and perform some
special operations before and after the installation of a device, and how you
can create FriendlyName for a device. The function and bus driver also show how
you can provide power manager and WMI support. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>You
can learn the implementation details of these sample drivers by looking at the
code and reading the Windows 2000/XP/Server 2003 DDK documentation. The rest of
this article discusses the contents of the package that accompanies this
article and how to install, build, and test these drivers. This article also
briefly examines the various registry entries created by the system to setup
and load the drivers. </span></p>

<p><b><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Note:</span></b><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>
This package is mostly intended to demonstrate WDM concepts for educational
purposes. It is not to be used in a production environment in its entirety. One
may not require all of the components of the package or all the features
demonstrated in a single component to have a working driver. </span></p>

<h3><a name=toast></a><span style='font-family:"Verdana","sans-serif";
mso-fareast-font-family:"Times New Roman"'>Introduction to the Toaster Sample </span><span
style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>This
sample driver package contains <i>bus</i>, <i>func</i>, <i>filter</i>, <span
class=GramE><i>inc</i></span>, <i>coinstaller</i>, <i>classinstaller</i>, <i>inf</i>,
<i>toastmon</i>, and <i>toastpkg</i> directories. The following summary
describes the directories and key files. </span></p>

<p><span class=GramE><i><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>bus</span></i></span><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> </span></p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>This directory contains the source code of the toaster
bus driver (Busenum.sys). The job of this driver is to service the TOASTER bus
controller, enumerate devices that are plugged in, and perform bus-level power
management. The bus driver supports D0 and D3 power states. It also has a WMI
interface.</span></p>

</blockquote>

<p><span class=GramE><i><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>func</span></i></span><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> </span></p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>All the sub-directories under this one contain the
source code of the function driver (Toaster.sys) for standard toaster devices.
To be illustrative and useful learning sample for beginners to driver
development, the sample has been built from almost nothing (skeletal) to fully
functional, adding useful features at each step. When built, all the different
versions produce toaster.sys file. You can use the standard toaster.inf or
toastco.inf to install and test. You can either manually install the driver
(root-enumerations) or bus enumerate the driver using the toaster bus driver.
They all share one common header file present in the <i>shared</i> directory.
Let us assume that the function driver owns the power policy of the toaster
device and supports D0, D1 and D3 power states, and also the toaster device is
capable of waking the system from D1 state. </span></p>

<ol style='margin-top:0in' start=1 type=1>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list .5in'><i><span
     style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif";
     mso-fareast-font-family:"Times New Roman"'>Incomplete1</span></i><span
     style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif";
     mso-fareast-font-family:"Times New Roman"'>: This is the simplest form of
     a WDM driver. It shows bare minimum functionality required to get
     installed and loaded in the system. You cannot open the device or talk to
     it. As the name suggests, this is not complete and safe enough to be used
     as a model for a production level driver. </span><span style='mso-fareast-font-family:
     "Times New Roman"'><o:p></o:p></span></li>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list .5in'><i><span
     style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif";
     mso-fareast-font-family:"Times New Roman"'>Incomplete2</span></i><span
     style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif";
     mso-fareast-font-family:"Times New Roman"'>: This version is slightly
     advanced than the incomplete1 version. This version shows how to track I/O
     IRPs and handle stop and remove PNP request safely with respect to driver
     unload. Instead of using remlocks, this sample implements its own locking
     scheme to be more general purpose and compatible with 9x systems. You can
     open the registered interface from usermode and send read, write and IOCTL
     requests. This is a still an incomplete sample because it doesn't handle
     power IRPs and do the necessary S to D power IRP conversion required by
     the bus driver. </span><span style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></li>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list .5in'><i><span
     style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif";
     mso-fareast-font-family:"Times New Roman"'>Featured1</span></i><span
     style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif";
     mso-fareast-font-family:"Times New Roman"'>: This is a complete version
     with full fledged power management and WMI support. </span><span
     style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></li>
 <li class=MsoNormal style='mso-list:l0 level1 lfo1;tab-stops:list .5in'><i><span
     style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif";
     mso-fareast-font-family:"Times New Roman"'>Featured2</span></i><span
     style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif";
     mso-fareast-font-family:"Times New Roman"'>: This version contains Wait-wake
     support and Event Tracing support in addition to all the features
     supported by featured1.</span><span style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></li>
</ol>

</blockquote>

<p class=MsoNormal style='margin-left:.5in'><span class=GramE><i><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>inc</span></i></span><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> </span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>This directory contains
headers files that are shared among drivers and applications. </span></p>

<p class=MsoNormal style='margin-left:.5in'><i><span style='font-size:10.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>Disk</span></i><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> </span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:10.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>This directory is the build
target path. All the toaster binaries are placed here during build under the
respecive build_environment\target_OS sub-directories. For example, if you
build under Windows Server 2003 x86 checked build environment, the target path
will be disk\chk_wnet_x86\i386\. Since there <span class=GramE>are</span> more
than one version of toaster.sys, it is not placed in this directory to avoid
overwriting one another. All the varoius versions of toaster.sys are built
under their respective source directory. </span></p>

<p class=MsoNormal><span class=GramE><i><span style='font-size:10.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>filter</span></i></span><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>This
directory contains six different subdirectories, each producing one of the
following drivers from a common source file (<i>filter.c</i>): </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Class
upper filter (<i>clsupper.sys</i>) </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Class
lower filter (<i>clslower.sys</i>) </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Device
upper filter (<i>devupper.sys</i>) </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Device
lower filter (<i>devlower.sys</i>) </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Bus
FDO upper filter (<i>bfdoupr.sys</i>) </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Bus
FDO lower filter (<i>bfdolwr.sys</i>) </span></p>

<p class=MsoNormal><span class=GramE><i><span style='font-size:10.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>coinstaller</span></i></span><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>This directory contains source code of the
device-specific coinstaller (<i>tostrco1.dll</i>). The DDK documentation has a
good overview of coinstaller and its operation. The coinstaller demonstrates
how to create a FriendlyName for a device based on its unique instance id. In
this sample, during enumeration, the bus driver provides the serial number in
the UINumber field of the device capabilities. The FriendlyName is required to
uniquely identify multiple devices of the same interface class. The coinstaller
also shows how to open an INF file and parse a custom section. </span></p>

<p class=MsoNormal><span class=GramE><i><span style='font-size:10.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>classinstaller</span></i></span><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>This directory contains source code of the
class-installer (<i>tostrcls.dll</i>). The DDK documentation has a good
overview of classinstaller and its operation. This dummy class-installer
included to provide a class icon for all the TOASTER Class devices. It is
copied to the system32 directory when the class is installed for the first time
in the system. </span></p>

<p class=MsoNormal><span class=GramE><i><span style='font-size:10.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'>inf</span></i></span><i><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> </span></i></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>This
directory contains 3 subdirectories (i386, amd64, &amp; ia64) and each contains
following files: </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><i><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>bus.inf</span></i><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>:
This .inf installs the <i>basenum.sys</i> and sets up the registry. </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><i><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>simple.inf</span></i><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>:
This .inf creates <b>Toaster</b> class, installs <i>toaster.sys</i> and sets up
the registry. </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><i><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>toaster.inf</span></i><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>:
This .inf file is functionally similar to <i>simple.inf</i> but also installs
the class-installer. The class-installer provides custom icon for the class and
an advanced property page to change the friendlyname of the device in the
device manager. </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><i><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>toastco.inf</span></i><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>:
This .inf file is functionally similar to toaster.inf but also installs the
coinstaller. The co-installer is used to dynamically create a unique
friendlyname of the device based on the serial number. </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><i><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>busf.inf</span></i><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>
and <i>toasterf.inf</i>: These two .inf files are functionally similar to the
above INF files but also install all the previously mentioned filter drivers. </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><i><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>filter.inf</span></i><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>:
This .inf installs just a device upper filter for the toaster device. Please
read the Filter section in this article on how to use this .inf file. </span></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:-.25in'><span
class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'>o</span></span><span
style='font-size:7.0pt;line-height:115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;
</span><i><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>toaster.cat</span></i><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>:
This is a dummy catalog file. </span></p>

<p><span class=GramE><i><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>toastmon</span></i></span><i><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> </span></i></p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>This has the source of a root-enumerated driver called <i>toastmon.sys</i>.
More information on this is covered later in the <b>Toastmon</b> section. </span></p>

</blockquote>

<p class=MsoNormal><a name=build></a><b><span style='font-family:"Verdana","sans-serif"'>Building
the sample</span></b></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>To
build the sample drivers, you must first set up the DDK environment on your
host machine. The “Installation and Release Notes” in the Windows Driver Kit
has a complete description on how to do this. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>1.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Run
the build –ceZ command in the Toaster directory to build all the binaries.</span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>2.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Copy
all the binaries, a bus driver INF file (bus.inf), toaster.cat, and a toaster
device INF file (toastco.inf) to a floppy disk or a temporary directory on the
target system. Do not copy all the INF files.</span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>3.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Copy
the device metadata package to a floppy disk or a temporary directory on the
target system. Use the device metadata package in the ja-jp folder if the
target system is in the Japanese locale. Otherwise, use the device metadata
package in the en-us folder. </span></p>

<h3><a name=install></a><span style='font-family:"Verdana","sans-serif";
mso-fareast-font-family:"Times New Roman"'>Installation</span><span
style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>First
install the bus driver. To install the bus driver on Windows 2000: </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>1.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Double-click
the ‘Add/Remove Hardware’ wizard in Control Panel. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>2.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>At
the Add/Remove Hardware Wizard, click <span class=GramE>Next</span>. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>3.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Choose
the ‘Add/Troubleshoot a device’, then click <span class=GramE>Next</span>. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>4.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Select
‘Add a new device’ from the list, then click Next. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>5.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Select
‘No, I Want to Select the Hardware from a list’ and then click Next. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>6.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Select
‘System Devices’ and then click Next. NOTE: This might take a few minutes. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>7.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Click
'Have Disk', make sure that 'A<span class=GramE>:\</span>' is in the &quot;Copy
manufacturer's files from:&quot; box, and click OK. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>8.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Click
on the desired of the two entries, and then click <span class=GramE>Next</span>.
</span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>9.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>At
'Start Hardware Installation,' click <span class=GramE>Next</span>. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>10.</span><span style='font-size:7.0pt;line-height:
115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Click
Finish at 'Completing the Add/Remove Hardware Wizard.' </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>To install the bus driver on Windows XP and Windows
Server 2003: </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>1.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Double-click
the ‘Add Hardware’ wizard in Control Panel. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>2.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>At</span></span><span style='font-size:
10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> the 'Welcome to
the Add Hardware Wizard', click ‘Next’. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>3.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Select
'Yes, I have already connected the hardware'<span class=GramE>,</span> then
click Next. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>4.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Select
‘Add a new hardware device’ from the list, then click Next. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>5.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Select
‘Install the hardware that I manually select from a <span class=GramE>list(</span>Advanced),'
and then click next. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>6.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Select
‘System Devices’, then click <span class=GramE>Next</span>. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>7.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Click
'Have Disk', make sure that 'A<span class=GramE>:\</span>' is in the &quot;Copy
manufacturer's files from:&quot; box, and click OK. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>8.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Click
on the desired entry, and then click <span class=GramE>Next</span>. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>9.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>At
'The wizard is ready to install your hardware', click <span class=GramE>Next</span>.
</span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>10.</span><span style='font-size:7.0pt;line-height:
115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Click
Finish at 'Completing the Add/Remove Hardware Wizard.' </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>To install the bus driver on Vista and later OS, use
devcon.exe as shown below.</span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Another
quick way to install the bus driver without going through so many mouse clicks
would be to use the Installer sample application present in the <i>src\tools\devcon</i>
directory. This sample allows you to root-enumerate a driver with one simple
command. Please read the help file included in the sample on how to build and
use the application to install this driver. To install the bus driver using
devcon.exe: </span></p>

<blockquote style='margin-top:5.0pt;margin-bottom:5.0pt'><pre>c:\&gt;devcon.exe<span
class=GramE>&nbsp; install</span>&nbsp; bus.inf&nbsp; &quot;root\busenum&quot;</pre>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>The system copies the <i>busenum.sys</i> file to the <i>%Systemroot%\system32\drivers</i>
directory and sets up the following registry keys to represent the bus driver
to the PnP manager:</span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Class<span
class=GramE>\{</span>4D36E97D-E325-11CE-BFC1-08002BE10318}\nnnn <br>
// nnnn is the instance number of this System Class driver on the system.</span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>It
copies the INF file as OEM.n.INF, where n is a zero-based number, to the system
INF directory. It also creates the standard Services keys to load the driver:</span></p>

<p><span class=GramE><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\busenum.</span></span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Once
installed the system creates device registry keys (Hardware keys) under:</span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum\Root\SYSTEM\nnnn
<br>
// nnnn is the instance number of this System Class driver on the system.</span></p>

</blockquote>

<h3><a name=test></a><span style='mso-fareast-font-family:"Times New Roman"'>To
install the device metadata package on Windows 7:<o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in'><span style='font-size:10.0pt;
line-height:111%;font-family:"Verdana","sans-serif";mso-fareast-font-family:
"Times New Roman";font-weight:normal'>1.</span><span style='font-size:7.0pt;
line-height:111%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";font-weight:normal'>&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;line-height:111%;font-family:"Verdana","sans-serif";
mso-fareast-font-family:"Times New Roman";font-weight:normal'>Copy the device
metadata package from the floppy drive or temporary file in the target system.</span><span
style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in'><span style='font-size:10.0pt;
line-height:111%;font-family:"Verdana","sans-serif";mso-fareast-font-family:
"Times New Roman";font-weight:normal'>2.</span><span style='font-size:7.0pt;
line-height:111%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";font-weight:normal'>&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;line-height:111%;font-family:"Verdana","sans-serif";
mso-fareast-font-family:"Times New Roman";font-weight:normal'>If the target
system is in the Japanese locale, paste it into
%programdata%\microsoft\windows\devicemetadatastore\ja-jp.</span><span
style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in'><span style='font-size:10.0pt;
line-height:111%;font-family:"Verdana","sans-serif";mso-fareast-font-family:
"Times New Roman";font-weight:normal'>3.</span><span style='font-size:7.0pt;
line-height:111%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";font-weight:normal'>&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;line-height:111%;font-family:"Verdana","sans-serif";
mso-fareast-font-family:"Times New Roman";font-weight:normal'>If the target
system is not in the Japanese locale, paste it into
%programdata%\microsoft\windows\devicemetadatastore\en-us.</span><span
style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<h3 style='margin-left:.5in;text-indent:-.25in'><span style='font-size:10.0pt;
line-height:111%;font-family:"Verdana","sans-serif";mso-fareast-font-family:
"Times New Roman";font-weight:normal'>4.</span><span style='font-size:7.0pt;
line-height:111%;font-family:"Times New Roman","serif";mso-fareast-font-family:
"Times New Roman";font-weight:normal'>&nbsp;&nbsp;&nbsp; </span><span
style='font-size:10.0pt;line-height:111%;font-family:"Verdana","sans-serif";
mso-fareast-font-family:"Times New Roman";font-weight:normal'>Note that this
action requires administrator privilege. Elevate the privilege when you are
prompted by entering the administrator’s user name and password.</span><span
style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<h3><span style='font-size:10.0pt;line-height:111%;font-family:"Verdana","sans-serif";
mso-fareast-font-family:"Times New Roman";font-weight:normal'>After you plug in
a toaster device, open the “Devices and Printers”. You will see the sample
toaster icon and sample information for the toaster sample. Note: the bus
devenode is not shown in the “Devices and Printers”. More information on how to
install device metadata packages is introduced in the device metadata package
section in WDK document.</span><span style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<h3><span style='font-family:"Verdana","sans-serif";mso-fareast-font-family:
"Times New Roman"'>Testing</span><span style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Once
the Toaster bus driver is installed and started by the PnP Manager, you can run
the <i>enum.exe</i> or Notify.exe application from the command prompt to
simulate plug in, unplug or ejection of toaster devices on the system. Both
these applications basically send an I/O control (IOCTL) to the bus driver with
the user provided globally unique serial number and Hardware ID of the device,
and trigger the entire enumeration process. The PnP manager takes the ID
information provided by the bus driver and searches the system INF directory to
find a matching INF file. If it doesn't find a suitable INF file (that would be
the case when you install for the first time) it prompts the user to specify an
INF file. At this point, you can pick one of the three INF files (toaster.inf,
toastco.inf or toasterf.inf) to be the device INF file. If you are testing this
sample for the first time, you should choose toastco.inf. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>You
can remove/eject a single device by giving its serial number or remove/eject
all the devices by specifying 0 (zero) as the serial number of the device. </span></p>

<p><b><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>To
plug in a device (or rather simulate a device arrival): </span></b></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>C:\&gt;enum
-p 1 </span></p>

<p class=MsoNormal><b><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>To unplug a device: </span></b></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>C:\&gt;enum -u 1 </span></p>

<p class=MsoNormal><b><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>To eject a device: </span></b></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>C:\&gt;enum -e 1 </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>To test a plugged in device, you can use the <i>toast.exe</i>
application. This application basically enumerates all the toaster class
devices, displays its properties such as FriendlyName, InstanceId, and opens
the last enumerated device to perform a read operation and send a
DeviceIoControl to the device depending on the user command line option. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>If
you invoke without any option it basically opens the last enumerated interface
and prompts you to initiate a Read operation in a loop. You press any key to
continue the read loop or press ‘q’ to break out of the loop. If you use the –h
option it opens the last enumerated interface and sends a DeviceIoControl to
hide the device from the Device Manager before performing read. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Usage:
Toast {-h option causes the device to hide from Device Manager UI} </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Both
these applications use the SetupDi functions to enumerate and open the device
interfaces. These functions are documented in the Windows 2000/XP/Server 2003 DDK
documentation. </span></p>

<h3><a name=filter></a><span style='font-family:"Verdana","sans-serif";
mso-fareast-font-family:"Times New Roman"'>Filters</span><span
style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>You
can install device filter drivers by specifying LowerFilters or UpperFilters to
the Hardware registry key (HKLM\ \SYSTEM\CurrentControlSet\Enum) for the
device; and class filters by specifying them to the Software registry key
(HKLM\SYSTEM\CurrentControlSet\Control\Class\) for the device class. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Because
this is an MULTI_SZ string, you can specify more than one filter for the device
or class. If you specify more than one, the load order is in the order they are
listed – the filter at the end of list is the topmost driver in the stack, and
so on. However filter drivers should not be written to rely on this order,
because the load order can change and other filter drivers may or may not be
there in the group. You can install device specific filters by using a [.HW]
section that specifies AddReg section, and class specific filters by specifying
AddReg section from the base install section in your INF file. The <i>busf.inf</i>
and <i>toasterf.inf</i> show how to do that. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>The
<i>filter.inf</i> file is a special .inf file that enables you to install a
filter driver for the toaster device after it has been installed and
enumerated. To install an upper device filter for a toaster device on Windows
2000: </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>1.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Enumerate
a toaster device. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>2.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Open
the Device Manager. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>3.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Open
the Properties of the Toaster device for which you want to install filter. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>4.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Click
the Driver tab, and then click Update Driver. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>5.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Follow
the wizard's prompts, and when prompted, select the Display a list of the known
<span class=GramE>drivers</span> option. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>6.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Click
Have Disk and point to the location of the filter.inf file. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>7.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Proceed
through the rest of the install. </span></p>

<h3><a name=params></a><span style='font-family:"Verdana","sans-serif";
mso-fareast-font-family:"Times New Roman"'>Device Parameters Subkey</span><span
style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Currently
the sample doesn’t show how to read Device Parameters value from the registry.
This feature will be added in the future updates of this driver. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Under
Windows 2000/XP/Server 2003, the configuration information is not stored under
the Services key of the driver. It is stored in three different places,
depending on whether <span class=GramE>it’s</span> device instance specific,
driver specific or interface specific. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>You
can store device-specific configuration information under the Hardware key of
that particular device instance
(HKLM\SYSTEM\CCS\Enum\&lt;DeviceId&gt;\&lt;VendorId&gt;\&lt;InstanceId&gt;\Device
Parameters) and driver-specific information under the Software key
(HKLM\SYSTEM\CCS\Control\Class\&lt;GUID&gt;\&lt;driver-instance-id&gt;\ Device
Parameters) of the driver by using <b>IoOpenDeviceRegistryKey</b> function. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>You
can store interface-specific information under the device-interface key
(HKLM\SYSTEM\CurrentControlSet\Control\DeviceClasses<span class=GramE>\{</span>GUID}\&lt;SymbolicLinkName&gt;\Device
Parameters) by calling <b>IopenDeviceInterfaceRegistryKey</b> with the symbolic
link name of the device interface. Both of these functions return the handle to
the <b>Device Parameters</b> subkey. For legacy support, you can continue to
store information under the Services key. </span></p>

<h3><a name=power></a><span style='font-family:"Verdana","sans-serif";
mso-fareast-font-family:"Times New Roman"'>Power Management</span><span
style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>In
this example, the function driver acts as a power policy owner for the toaster
device and supports DO and D3 power mode. You can use the same power logic to
implement power policy in the bus driver. You need a system with an
ACPI-compatible BIOS in order to test the power management code. If you have an
ACPI compatible system, you will see a Standby option in the Shutdown submenu. </span></p>

<h1><span style='mso-fareast-font-family:"Times New Roman"'>Code Walkthrough<o:p></o:p></span></h1>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>Following paragraphs illustrate how the funcion driver
handles various power requests (power.c). The graph below shows the order in
which various functions are called in each case. For clarity, the word Toaster
has been removed from all the function names. </span></p>

<p><b><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Query
Power Request (IRP_MN_QUERY_POWER)<span class=GramE>:<span style='font-weight:
normal'>The</span></span></span></b><span style='font-size:10.0pt;line-height:
115%;font-family:"Verdana","sans-serif"'> function driver first sends the
system query power IRP (S-IRP) down to the bus driver and when the IRP gets
completed, it generates a device query power IRP (D-IRP) in the completion
routine. The S-IRP is marked pending and saved in the FDO device-extension. The
function driver then receives the newly generated D-IRP as it gets sent from
the top of the stack by the power manager. If the device is going into a low
power state, it marks the queue state to hold any incoming requests, waits for
the all the pending I/Os to complete, and forwards the D-IRP down to the bus
driver. When the bus driver completes the IRP, the power manager calls the
power IRP completion routine. Here, in the power IRP completion routine, the
function driver completes the S-IRP.</span></p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp; DispathPower (S-IRP)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp; |</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp; |----&gt;DispatchQueryPowerState</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;DispatchSystemPowerIrp</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;PoCallDriver to Busdriver</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CompletionSystemPowerIrp*&lt;----|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;QueueCorrespondingDeviceIrp (1)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;DispathPower (D-IRP)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|----&gt;DispatchQueryPowerState</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;DispatchDeviceQueryPower (2)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|----&gt;FinalizeDevicePowerIrp</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;PoCallDriver to Busdriver</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CompletionOnFinalizedDeviceIrp**&lt;----|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;IoCompleteRequest (S-IRP)</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal><b><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Set Power Request to Power-<span
class=GramE>Down(</span>IRP_MN_SET_POWER):</span></b><span style='font-size:
10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> The function
driver first sends the S-IRP down to the bus driver and when it completes, it
generates a D-IRP in the completion routine. The S-IRP is marked pending and
saved in the FDO device-extension. The function driver then receives the newly
generated D-IRP as it gets sent from the top of the stack. If the device is going
into low power state, it saves the device context, powers down the device and
then forwards the D-IRP down to the bus driver. When the bus driver completes
the IRP, the power manager calls the power IRP completion routine. Here the
function driver completes the S-IRP. </span></p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp; DispathPower (SIRP)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp; |</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp; |----&gt;DispatchSetPowerState</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;DispatchSystemPowerIrp</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;PoCallDriver to Busdriver</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CompletionSystemPowerIrp*&lt;----|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;QueueCorrespondingDeviceIrp (call PoRequestPowerIrp to generate D-IRP)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;DispathPower (D-IRP)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;DispatchSetPowerState (D-IRP)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;DispatchDeviceSetPower</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;CallbackHandleDeviceSetPower (3) </p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|----&gt;FinalizeDevicePowerIrp</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;PoCallDriver to Busdriver</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CompletionOnFinalizedDeviceIrp**&lt;----|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp; </p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|---&gt;IoCompleteRequest
(S-IRP)</p>

<p class=MsoNormal><b><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Set Power Request to Power-<span
class=GramE>Up(</span>IRP_MN_SET_POWER):</span></b><span style='font-size:10.0pt;
line-height:115%;font-family:"Verdana","sans-serif"'> The function driver first
sends the S-IRP down to the bus driver and when it completes it generates a
D-IRP in the completion routine. The S-IRP is marked pending and saved in the
device extension. The function driver then receives the newly generated D-IRP
as it gets sent from the top of the stack. If the pending S-IRP is for
restoring the power state of the system to S0, the driver first completes the
S-IRP and then if the device is in a low power state, it powers up the device,
restores the device context and processes any pending IRPs waiting in the
queue. The reason the S-IRP is completed before the D-IRP during power-up is to
speed-up the system resume as restoring the device to Do usually takes longer.
One thing to note here is that to avoid receiving remove IRP from PNP manager,
you must first request D-IRP and then complete the S-IRP, You shouldn't do that
in reverse order because the PNP manager guarantees that as long as an S-IRP is
pending, it will not send a remove request. Then the function driver forwards
the D-IRP down to the bus driver. When the bus driver completes the IRP, the
power manager calls the power IRP completion routine. Here the function driver
completes the S-IRP. </span></p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp; DispathPower (SIRP)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp; |</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp; |----&gt;DispatchSetPowerState</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;DispatchSystemPowerIrp</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;PoCallDriver to Busdriver</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CompletionSystemPowerIrp*&lt;----|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; |</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;QueueCorrespondingDeviceIrp (call PoRequestPowerIrp to generate D-IRP)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;DispathPower (D-IRP)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;|----&gt;DispatchSetPowerState (D-IRP)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;DispatchDeviceSetPower (Complete S-IRP)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|----&gt;PoCallDriver
to Busdriver</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CompletionDevicePowerUp*&lt;----|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|----&gt;CallbackHandleDeviceSetPower
(4)</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;FinalizeDevicePowerIrp </p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|----&gt;IoCompleteRequest
(D-IRP) </p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
|----&gt;CompletionOnFinalizedDeviceIrp**</p>

<p class=MsoNormal>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>* - This is an IRP completion routine set using
IoSetCompletionRoutine.</span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>**
- This is a Power IRP completion routine specified in PoRequestPowerIrp when we
generate D-IRP. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>The
difference is that the IRP completion routine is called by the I/O manager when
the lower driver calls IoCompleteRequest but the power IRP completion routine
is called by Power manager, just before freeing the IRP memory, when the IRP
finally returns back to it. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>1.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Calls
PoRequestPowerIrp to generate D-IRP and sets CompletionOnFinalizedDeviceIrp as
the power IRP completion routine. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>2.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>If
the system is going to lower power state, start queuing requests. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>3.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>This
is a worker thread spawned to run at PASSIVE_LEVEL. Here, save the
device-context and power-down <span class=GramE>the devie</span>. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>4.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>This
is a worker thread spawned to run at PASSIVE_LEVEL. Here, power-up the device
and restore device context. If there are IRPs pending in the queue process <span
class=GramE>them.</span> </span></p>

<h3><a name=wmi></a><span style='font-family:"Verdana","sans-serif";mso-fareast-font-family:
"Times New Roman"'>WMI</span><span style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>A
WMI interface is provided to both the function and bus driver. The WMI library
is used to handle WMI IRPs. The MOF files, which define WMI data and event
blocks, are compiled along with the driver and included in the driver’s binary
image. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>To
test the WMI interface, first install the WMI SDK on your system. Then, use
either <i>wbemtest.exe</i> or CIM Studio to enumerate the instances registered
by these drivers. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>For
example, to see the data exported by the Toaster driver: </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>1.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Run
<i>wbemtest.exe</i>. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>2.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Connect
to “root\WMI” class. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>3.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Click
Enum Instances. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>4.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Type
ToasterDeviceInformation and press Enter. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>You should see the toaster device instances. The
DebugPrintLevel data in both the drivers have been made read/write, so that it
is possible to dynamically change the value of these variables with the WMI
application and control the driver debug trace seen on Windbg. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>You
can also generate a HTML script using the bmf file (wmimofck -whtml
toaster.bmf) and test both the data and event blocks exported by the driver.
The toaster driver fires a ToasterNotifyDeviceArrival event every time a device
is plugged in and started successfully. For more information on WMI testing,
check http://support.microsoft.com/support/kb/articles/q252/6/79.asp. The
function driver's WMI handler also responds to WMI queries from Device Manager
to provide Power Manangement tab in the device properties dialog. </span></p>

<h3><a name=etw></a><span style='font-family:"Verdana","sans-serif";mso-fareast-font-family:
"Times New Roman"'>Event Tracing (ETW)</span><span style='mso-fareast-font-family:
"Times New Roman"'><o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Event
tracing in Windows (aka software tracing) allows drivers to log debug trace
messages efficiently without affecting system performance. You can selectively
enable tracing on your target machine and log messages. You can do the tracing
both on free and checked build system without requiring a kernel-debugger or
serial connection. You can watch the traces simultaneously in the target
machine and also in the kernel-debugger. The steps required to provide software
tracing is fairly easy and documented in the DDK &quot;WPP Software
Tracing&quot; section. These are the following things I did to get tracing
support in toaster function driver. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>1.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Generated
a GUID (C56386BD-7C67-4264-B8D9-C4A53B93CBEB) using GUIDGEN. This GUID will be
used as the control Guid (provider guid) for toaster. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>2.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Defined
the debug flags and GUID in a header file (toaster.h). Look for WPP_CONTROL_GUIDS.
</span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>3.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span class=GramE><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'>Included</span></span><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> a
file called xyz.tmh, where xyz is name of the source file, in every source file
after all other includes files and before any WPP macros are called. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>4.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Registered
for tracing in DriverEntry by calling WPP_INIT_<span class=GramE>TRACING(</span>DriverObject,
RegistryPath). </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>5.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Deregistered
for tracing in ToasterUnload by calling WPP_<span class=GramE>CLEANUP(</span>DriverObject).
</span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>6.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Added
RUN_WPP=$(SOURCES) line to &quot;sources&quot; file to pre-process the WPP
macro and generate xyz.tmh files. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>7.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Informed
RUN_WPP to map all my ToasterDebugPrint calls to native DoTraceMessage function
by using the <i>func:</i> option in RUN_WPP preprocessor directive. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Through
out the code, you will see different implementation for enabling tracing on
Windows 2000. This is due to the fact that tracing enable/disable is handled
via IRP_MJ_SYSTEM_CONTROL dispatch handler in Win2K and via an explicit
callback in XP and beyond. So if you have your own WMI handler, you have to add
few extra WPP macros to workaround the issue. This also has an unavoidable
side-effect that drivers on Win2K can be traced only if they have a device
object. So, for WDM drivers that typically create their deviceobject in
AddDevice, it's not possible to trace DriverEntry calls. </span></p>

<p><b><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Logging
the traces in a file:</span></b><span style='font-size:10.0pt;line-height:115%;
font-family:"Verdana","sans-serif"'> </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>1.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Generate
Trace message format (.TMF) files from the toaster.pdb file. You can do that by
calling &quot;tracepdb -f toaster.pdb&quot; in the DDK build environment. This
command will produce two files, C56386BD-7C67-4264-B8D9-C4A53B93CBEB.tmc and
yyy.tmf, where yyy is some guid, for every source <span class=GramE>file</span>
that makes the ToasterDebugPrint tracing call. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>2.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Copy
all the tmf files to the target machine in a temporary directory, say c:\temp. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>3.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Install
the toaster driver. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>4.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Copy
all the tracing tools from %DDKROOT%\tools\tracing directory to your target
machine's temp directory. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>5.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Create
a text file called toaster.ctl, and add the following line, &quot;C56386BD-7C67-4264-B8D9-C4A53B93CBEB
toaster&quot;. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>6.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Set
TRACE_FORMAT_SEARCH_PATH environment variable to point to the directory where
the TMF files are present. In our case, it is c:\temp. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>7.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Enable
debug tracing by calling &quot;tracelog -start -guid toaster.ctl -f toaster.bin
-flags 0x1&quot; </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>8.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Force
the driver to do something. You can either disable/enable or run toast.exe and
send read requests. All the debug messages will be logged in toaster.bin file
in a binary form. </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>9.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Stop
the logger by calling &quot;tracelog -stop toaster&quot; </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>10.</span><span style='font-size:7.0pt;line-height:
115%;font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Finally,
format the binary log file to get human readable text file by calling
&quot;tracefmt -nosummary toaster.txt toaster.bin&quot;. </span></p>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Note
that you can also get realtime traces by using the -<span class=GramE>rt</span>
option of tracelog at the time you enable the tracing. You can also use the
TRACEVIEW (src\tools\traceview) utility from the DDK to get the traces easily.
This GUI tool has been built around the other tracing utilities mentioned above
to make the task of getting traces a lot easier. </span></p>

<p><b><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Getting
the traces in realtime on the host machine and in kernel debugger:</span></b><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'> </span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>1.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Enable
realtime tracing on the target machine with -<span class=GramE>kd</span>
option. </span></p>

<pre style='margin-left:.5in'>c:\temp&gt;tracelog -start toaster -<span
class=GramE>rt</span> -kd -ft 1 -guid toaster.ctl -flags 0xff</pre>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>2.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>On
the host-side, in the kernel debugger, turn on dynamic printing by <span
class=GramE>using !WMITRACE</span> debugger extension. </span></p>

<pre style='margin-left:.5in'><span class=GramE>kd</span>&gt;!wmitrace.dynamicprint 1</pre>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>3.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Then,
set the WMI trace search path to the directory that contains all the TMF files
generated earlier. </span></p>

<pre style='margin-left:.5in'><span class=GramE>kd</span>&gt;!wmitrace.searchpath path_of_TMF_files</pre>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>4.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Also
make sure <span class=GramE>that !</span>wmitrace.guidfile is set to
default.tmf or system.tmf depending on where you have that file in relation to
the debugger.</span></p>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>5.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>If
the tracing is enabled, you should see a 'toaster' session entry listed when
you dump the event trace structures. For example: </span></p>

<pre>&nbsp;</pre><pre>0: kd<span class=GramE>&gt; !</span>wmitrace.strdump</pre><pre>(WmiTracing)StrDump Generic</pre><pre>&nbsp; LoggerContext Array @ 0x80BF1760 [64 Elements]</pre><pre>&nbsp;&nbsp;&nbsp; Logger Id<span
class=GramE>&nbsp; 2</span> @ 0x820C5000 Named 'MSDTC_TRACE_SESSION'</pre><pre>&nbsp;&nbsp;&nbsp; Logger Id<span
class=GramE>&nbsp; 3</span> @ 0x81AAF000 Named 'toaster'</pre>

<p class=MsoNormal><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'>6.</span><span style='font-size:7.0pt;line-height:115%;
font-family:"Times New Roman","serif"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>You
can view the traces in realtime on the target machine by running: </span></p>

<pre style='margin-left:.5in'>tracefmt.exe -<span class=GramE>rt</span> toaster -p path_of_TMF_files -display</pre>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Please
note <span class=GramE>that !</span>wmitrace debugger extension is not
supported on Win2K. So you wouldn't able to see the traces of a Win2K system in
a kernel debugger. </span></p>

<h3><a name=tmon></a><span style='font-family:"Verdana","sans-serif";
mso-fareast-font-family:"Times New Roman"'>Toastmon</span><span
style='mso-fareast-font-family:"Times New Roman"'><o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>This
driver demonstrates how to handle PnP notification in kernel-mode. Using the
toastmon.inf file you can install this driver with Add Hardware wizard. This
driver gets root-enumerated and in its AddDevice, it registers for device
arrival notification on the Toaster interface class. When you plugin a toaster
device, the system calls the notification handler and the driver opens the
associated device and registers for Device Change notification. When you
disable/unplug/eject the toaster device the driver notification handler is
called to close handle to the device. The technique demonstrated in this sample
is useful when you write a driver that wants to talk to a device that your
driver is not controlling. </span></p>

<p align=center style='text-align:center'><a name=notes></a><a href="#top"><span
style='font-size:10.0pt;line-height:115%;font-family:"Verdana","sans-serif"'>Top
of page</span></a><span style='font-size:10.0pt;line-height:115%;font-family:
"Verdana","sans-serif"'> </span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=936
 style='width:6.5in;mso-cellspacing:0in;mso-yfti-tbllook:1184;mso-padding-alt:
 0in 0in 0in 0in'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;mso-yfti-lastrow:yes;
  height:1.5pt'>
  <td style='background:aqua;padding:.75pt .75pt .75pt .75pt;height:1.5pt'></td>
 </tr>
</table>

<p><span style='font-size:7.5pt;line-height:115%;font-family:"MS Sans Serif","serif"'>©
Microsoft Corporation 2002</span><span style='font-size:10.0pt;line-height:
115%;font-family:"Verdana","sans-serif"'> </span></p>

</div>

</body>

</html>

