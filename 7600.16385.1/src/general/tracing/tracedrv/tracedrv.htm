<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 12 (filtered)">
<title>TraceDrv</title>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Courier;
	panose-1:2 7 4 9 2 2 5 2 4 4;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Tahoma;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:Verdana;
	panose-1:2 11 6 4 3 5 4 4 2 4;}
@font-face
	{font-family:"MS Sans Serif";
	panose-1:0 0 0 0 0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Arial","sans-serif";
	font-weight:bold;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-right:0in;
	margin-left:0in;
	font-size:18.0pt;
	font-family:"Times New Roman","serif";
	font-weight:bold;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-right:0in;
	margin-left:0in;
	font-size:13.5pt;
	font-family:"Times New Roman","serif";
	font-weight:bold;}
p.MsoCommentText, li.MsoCommentText, div.MsoCommentText
	{mso-style-link:"Comment Text Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:blue;
	text-decoration:underline;}
p
	{margin-right:0in;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoCommentSubject, li.MsoCommentSubject, div.MsoCommentSubject
	{mso-style-link:"Comment Subject Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:10.0pt;
	font-family:"Times New Roman","serif";
	font-weight:bold;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Balloon Text Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:8.0pt;
	font-family:"Tahoma","sans-serif";}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Cambria","serif";
	color:#365F91;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Cambria","serif";
	color:#4F81BD;
	font-weight:bold;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Cambria","serif";
	color:#4F81BD;
	font-weight:bold;}
span.CommentTextChar
	{mso-style-name:"Comment Text Char";
	mso-style-link:"Comment Text";}
span.CommentSubjectChar
	{mso-style-name:"Comment Subject Char";
	mso-style-link:"Comment Subject";
	font-weight:bold;}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-link:"Balloon Text";
	font-family:"Tahoma","sans-serif";}
.MsoChpDefault
	{font-size:10.0pt;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-US link=blue vlink=blue>

<div class=Section1>

<h2><span style='font-family:"Verdana","sans-serif"'>Tracedrv </span></h2>

<h3><span style='font-family:"Verdana","sans-serif"'>SUMMARY</span></h3>

<p class=MsoNormal>Tracedrv is a sample driver instrumented for software
tracing. The driver does not control any hardware; it simply generates trace
messages. It is designed to show how to use WPP software tracing macros in a
driver. </p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Tracedrv initializes tracing (by using WPP_INIT_TRACING)
and, when it receives a DeviceIOControl call, it starts a thread that logs 100
trace messages. The WPP software tracing directives, calls, and macros in the
code are accompanied by comments that explain their purpose.</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>While examining Tracedrv, read the &quot;WPP Software
Tracing&quot; section of the Windows Driver Development Kit (DDK) documentation
(in Driver Development Tools, Tools for Software Tracing, WPP Software
Tracing). This section includes a reference section that describes the
directives, macros, and calls required for WPP software tracing. It also
includes &quot;Sample WPP Software Tracing Code,&quot; a section that uses the
Tracedrv sample to demonstrate the use of the WPP software tracing elements.</p>

<p class=MsoNormal>&nbsp;</p>

<h3><span style='font-family:"Verdana","sans-serif"'>USING THE SAMPLE</span></h3>

<p class=MsoNormal>To test the Tracedrv event tracing provider, use the
following procedure. The tools used in this procedure are included in the DDK
and located in the \tools\tracing subdirectory. For more information about the
tracing tools, see the &quot;Tools for Software Tracing&quot; section of the
DDK documentation.</p>

<ol start=1 type=1>
 <li class=MsoNormal>Build the Tracedrv sample driver by using the <b>-cZg</b>
     switch. For more information, see &quot;Building a Sample Driver&quot; in
     the DDK.<br>
     <br>
 </li>
 <li class=MsoNormal>Build the Tracectl executable file by using the -<b>cZg</b>
     switch. Tracectl is located in the \src\general\tracing\tracedrv\tracectl
     subdirectory of the DDK. Tracectl sends IOCTLs to Tracedrv, which then
     generates trace messages when it receives the IOCTLs.<br>
     <br>
 </li>
 <li class=MsoNormal>Copy<i> </i>the <i>Tracectl.exe </i>file that was created
     in step 2 from the Tracectl directory (\src\general\tracing\tracedrv\tracectl\<i>platform</i>)
     to the Tracedrv directory (\src\general\tracing\tracedrv\tracedrv\<i>platform</i>).<br>
     <br>
 </li>
 <li class=MsoNormal>Use Tracepdb to create a trace message format (TMF) file
     and a trace message control (TMC) file from the <i>Tracedrv.pdb</i> file.
     Tracepdb is located in the \tools\tracing\<i>platform</i> subdirectory of
     the DDK. The PDB file that is used in this command is created by the Build
     utility in step 1. From the \tools\tracing\<i>platform</i> subdirectory,
     type the following command: </li>
</ol>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'>tracepdb -f &lt;path&gt;\tracedrv.pdb</span></p>

<ol start=5 type=1>
 <li class=MsoNormal>Create a control GUID file for Tracedrv by opening a text
     file, adding the following content, and saving the file as Tracedrv.ctl. </li>
</ol>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'>      CtlGuid d58c126f-b309-11d1-969e-0000f875a5bc</span></p>

<ol start=6 type=1>
 <li class=MsoNormal>Use Tracelog to start a trace session that is called
     &quot;TestTracedrv&quot;. Tracelog is located in the \tools\tracing\<i>platform</i>
     subdirectory of the DDK. The <i>Tracedrv.ctl</i> file that is used in this
     command was created in step 4. The following command starts a trace
     session and creates a trace log file, <i>tracedrv.etl</i>, in the local
     directory.</li>
</ol>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'>      tracelog -start TestTracedrv -guid
tracedrv.ctl -f tracedrv.etl -flag 1</span></p>

<p style='margin-left:.5in'><b>Note:</b> Without the <b>-flag</b> parameter,
Tracedrv will not generate any trace messages.</p>

<ol start=7 type=1>
 <li class=MsoNormal>To generate trace messages, run <i>Tracectl.exe</i>. This
     executable file is built in step 2. Each time you type a character, other
     than <b>Q</b> or <b>q</b>, Tracectl sends an IOCTL to the driver that
     signals it to generate trace messages. To stop Tracectl, type <b>Q</b> or <b>q</b>.<br>
     <br>
 </li>
 <li class=MsoNormal>To stop the trace session, use the following Tracelog
     command.</li>
</ol>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'>      tracelog -stop TestTracedrv</span></p>

<ol start=9 type=1>
 <li class=MsoNormal>To display the trace messages in the <i>Tracedrv.etl</i>
     file, use Tracefmt. Tracefmt is located in the \tools\tracing subdirectory
     of the DDK. The TMF file used in this command was created by Tracepdb in
     step 3. Type the following command: </li>
</ol>

<p class=MsoNormal style='margin-left:1.0in'><span style='font-size:10.0pt;
font-family:"Courier New"'>      tracefmt tracedrv.etl -p &lt;Path to TMF
file&gt; -o Tracedrv.out</span></p>

<p>The resulting <i>Tracedrv.out</i> file is a human-readable text file of the
Tracedrv trace messages. To interpret the trace messages, in the <i>Tracedrv.c</i>
file, search for the <b>DoTraceMessage</b> macros.</p>

<p class=MsoNormal style='margin-left:.5in'>&nbsp;</p>

<h3><span style='font-family:"Verdana","sans-serif"'>LIMITATIONS</span></h3>

<p class=MsoNormal>This sample driver should not be used in a production
environment. </p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Tracedrv is designed for Windows&nbsp;XP and later versions
of Windows. It does not demonstrate how to add WPP software tracing to a
Windows&nbsp;2000 driver. (For information about adding WPP software tracing to
a Windows&nbsp;2000 driver, see the Tracing FAQ topic in the Windows DDK
documentation.)</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Also, because it is not a Plug and Play driver, Tracedrv
does not demonstrate tracing in a Plug and Play environment. </p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Tracedrv demonstrates the basic elements required for
software tracing. It does not demonstrate more advanced tracing techniques,
such as writing customized tracing calls (variations of <b>DoTraceMessage</b>),
or the use of WMI calls for software tracing. </p>

<p class=MsoNormal>&nbsp;</p>

<h3><span style='font-family:"Verdana","sans-serif"'>FILE LIST</span></h3>

<p class=MsoNormal>drvioctl.h</p>

<p class=MsoNormal>makefile</p>

<p class=MsoNormal>sources</p>

<p class=MsoNormal>tracedrv.c</p>

<p class=MsoNormal>tracedrv.ctl</p>

<p class=MsoNormal>tracedrv.rc</p>

<p class=MsoNormal>&nbsp;</p>

<h3><span style='font-family:"Verdana","sans-serif"'>LOCATION</span></h3>

<p class=MsoNormal>The files that comprise Tracedrv are included in the Windows
DDK in the \src\general\tracing\tracedrv directory.</p>

<h3><span style='font-family:"Verdana","sans-serif"'>&nbsp;</span></h3>

<h3><span style='font-family:"Verdana","sans-serif"'>FEEDBACK</span></h3>

<p><span style='font-size:10.0pt;font-family:"Verdana","sans-serif"'>We welcome
your comments, problem reports, and wish-list requests. Please submit them by
visiting the <a href="http://go.microsoft.com/fwlink/?linkid=8704&amp;clcid=0x409">Windows
DDK Web site</a>. </span></p>

<p align=center style='text-align:center'><span style='font-size:10.0pt;
font-family:"Verdana","sans-serif"'><a
href="file:///D:\INF\Readmes%20-%20Post%20WinHEC%202000\ChkInf.htm#top">Top of
page</a> </span></p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0 width=624
 style='width:6.5in'>
 <tr style='height:1.5pt'>
  <td style='background:aqua;padding:.75pt .75pt .75pt .75pt;height:1.5pt'>
  <p class=MsoNormal><span style='font-size:2.0pt'>&nbsp;</span></p>
  </td>
 </tr>
</table>

<p><span style='font-size:7.5pt;font-family:"MS Sans Serif","serif"'>©
Microsoft Corporation 2005</span><span style='font-size:10.0pt;font-family:
"Verdana","sans-serif"'> </span></p>

</div>

</body>

</html>

