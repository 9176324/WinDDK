<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List href="sdiosample_files/filelist.xml">
<title>SDIO Sample Driver</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="Street"/>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="address"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Template>Normal</o:Template>
  <o:Revision>7</o:Revision>
  <o:TotalTime>255</o:TotalTime>
  <o:Created>2000-02-24T06:44:00Z</o:Created>
  <o:LastSaved>2003-03-26T18:03:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>652</o:Words>
  <o:Characters>3722</o:Characters>
  <o:Company>Microsoft Corp.</o:Company>
  <o:Lines>31</o:Lines>
  <o:Paragraphs>8</o:Paragraphs>
  <o:CharactersWithSpaces>4366</o:CharactersWithSpaces>
  <o:Version>10.4219</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
    {font-family:"MS Mincho";
    panose-1:2 2 6 9 4 2 5 8 3 4;
    mso-font-alt:"\FF2D\FF33 \660E\671D";
    mso-font-charset:128;
    mso-generic-font-family:roman;
    mso-font-format:other;
    mso-font-pitch:fixed;
    mso-font-signature:1 134676480 16 0 131072 0;}
@font-face
    {font-family:Verdana;
    panose-1:2 11 6 4 3 5 4 4 2 4;
    mso-font-charset:0;
    mso-generic-font-family:swiss;
    mso-font-pitch:variable;
    mso-font-signature:536871559 0 0 0 415 0;}
@font-face
    {font-family:"\@MS Mincho";
    mso-font-charset:128;
    mso-generic-font-family:auto;
    mso-font-pitch:auto;
    mso-font-signature:0 0 0 0 0 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
    {mso-style-parent:"";
    margin:0in;
    margin-bottom:.0001pt;
    mso-pagination:widow-orphan;
    font-size:12.0pt;
    font-family:"Times New Roman";
    mso-fareast-font-family:"Times New Roman";
    color:windowtext;}
h2
    {mso-margin-top-alt:auto;
    margin-right:0in;
    mso-margin-bottom-alt:auto;
    margin-left:0in;
    mso-pagination:widow-orphan;
    mso-outline-level:2;
    font-size:18.0pt;
    font-family:"Times New Roman";
    color:black;
    font-weight:bold;}
h3
    {mso-margin-top-alt:auto;
    margin-right:0in;
    mso-margin-bottom-alt:auto;
    margin-left:0in;
    mso-pagination:widow-orphan;
    mso-outline-level:3;
    font-size:13.5pt;
    font-family:"Times New Roman";
    color:black;
    font-weight:bold;}
h4
    {mso-margin-top-alt:auto;
    margin-right:0in;
    mso-margin-bottom-alt:auto;
    margin-left:0in;
    mso-pagination:widow-orphan;
    mso-outline-level:4;
    font-size:12.0pt;
    font-family:"Times New Roman";
    color:black;
    font-weight:bold;}
p.MsoBodyText, li.MsoBodyText, div.MsoBodyText
    {margin:0in;
    margin-bottom:.0001pt;
    mso-pagination:widow-orphan;
    font-size:10.0pt;
    mso-bidi-font-size:12.0pt;
    font-family:Verdana;
    mso-fareast-font-family:"MS Mincho";
    mso-bidi-font-family:"Times New Roman";
    color:windowtext;}
p
    {mso-margin-top-alt:auto;
    margin-right:0in;
    mso-margin-bottom-alt:auto;
    margin-left:0in;
    mso-pagination:widow-orphan;
    font-size:12.0pt;
    font-family:"Times New Roman";
    mso-fareast-font-family:"Times New Roman";
    color:black;}
pre
    {margin:0in;
    margin-bottom:.0001pt;
    mso-pagination:widow-orphan;
    tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
    font-size:10.0pt;
    font-family:"Courier New";
    mso-fareast-font-family:"Courier New";
    color:black;}
@page Section1
    {size:8.5in 11.0in;
    margin:1.0in 1.25in 1.0in 1.25in;
    mso-header-margin:.5in;
    mso-footer-margin:.5in;
    mso-paper-source:0;}
div.Section1
    {page:Section1;}
 /* List Definitions */
 @list l0
    {mso-list-id:146359864;
    mso-list-template-ids:1022758592;}
@list l1
    {mso-list-id:1082918253;
    mso-list-template-ids:-1544494930;}
@list l2
    {mso-list-id:1393195126;
    mso-list-type:hybrid;
    mso-list-template-ids:370729058 -1300059700 -1881530170 -1340449604 -231067110 1994148784 499707558 165840150 746242626 -833344814;}
@list l2:level1
    {mso-level-tab-stop:.5in;
    mso-level-number-position:left;
    text-indent:-.25in;}
@list l2:level2
    {mso-level-tab-stop:1.0in;
    mso-level-number-position:left;
    text-indent:-.25in;}
@list l2:level3
    {mso-level-tab-stop:1.5in;
    mso-level-number-position:left;
    text-indent:-.25in;}
@list l2:level4
    {mso-level-tab-stop:2.0in;
    mso-level-number-position:left;
    text-indent:-.25in;}
@list l2:level5
    {mso-level-tab-stop:2.5in;
    mso-level-number-position:left;
    text-indent:-.25in;}
@list l2:level6
    {mso-level-tab-stop:3.0in;
    mso-level-number-position:left;
    text-indent:-.25in;}
@list l2:level7
    {mso-level-tab-stop:3.5in;
    mso-level-number-position:left;
    text-indent:-.25in;}
@list l2:level8
    {mso-level-tab-stop:4.0in;
    mso-level-number-position:left;
    text-indent:-.25in;}
@list l2:level9
    {mso-level-tab-stop:4.5in;
    mso-level-number-position:left;
    text-indent:-.25in;}
@list l3
    {mso-list-id:1951358305;
    mso-list-template-ids:383835376;}
ol
    {margin-bottom:0in;}
ul
    {margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
    {mso-style-name:"Table Normal";
    mso-tstyle-rowband-size:0;
    mso-tstyle-colband-size:0;
    mso-style-noshow:yes;
    mso-style-parent:"";
    mso-padding-alt:0in 5.4pt 0in 5.4pt;
    mso-para-margin:0in;
    mso-para-margin-bottom:.0001pt;
    mso-pagination:widow-orphan;
    font-size:10.0pt;
    font-family:"Times New Roman";}
</style>
<![endif]-->
</head>

<body lang=EN-US style='tab-interval:.5in'>

<div class=Section1>

<h2><span style='font-family:Verdana'>Driver Framework SDIO Sample Driver<o:p></o:p></span></h2>

<h3><span style='font-size:14.0pt;mso-bidi-font-size:13.5pt;font-family:Verdana'>Description<o:p></o:p></span></h3>

<p class=MsoBodyText>This is a sample for a functional Secure Digital (SD) IO driver.  The driver is written using the Kernel Mode Driver Framework.  It is a driver for a generic mars development board that implements the SDIO protocol without additional functionality.</p>

<h4><span style='font-size:14.0pt;mso-bidi-font-size:13.5pt;font-family:Verdana'>Theory of Operation <o:p></o:p></span></h4>
<p class=MsoBodyText>The mars board driver exemplifies several different functions that are essential for writing an SDIO driver that leverages KDMF and the SDBUS API.  It will show how to:
<br>- Install and start an SDIO device.
<br>- Release an SDIO device.
<br>- Perform data transfers.
<br>- Alter the settings that the SDIO device uses to communicate with the SD Host Controller.
</p>

<p><span style='font-size:10.0pt;font-family:Verdana'>The driver building and
installation instructions given here apply only to Windows® XP and later operating systems.<o:p></o:p></span></p>

<p><b><span style='font-size:10.0pt;font-family:Verdana'>Note</span></b><span
style='font-size:10.0pt;font-family:Verdana'>: This sample provides an example
of a minimal driver. Neither the driver nor the sample programs are intended
for use in a production environment. Rather, they are intended for educational
purposes and as a skeleton driver.<o:p></o:p></span></p>

<h3><span style='font-size:14.0pt;mso-bidi-font-size:13.5pt;font-family:Verdana'>Building
the Sample<o:p></o:p></span></h3>

<p><span style='font-size:10.0pt;font-family:Verdana'>Click the Free Build
Environment or Checked Build Environment icon under your <b>Development Kits </b>program
group to set basic environment variables needed by the build utility. <o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>Change to the directory
containing the device source code, such as <b>src\sd\sdiomars</b><o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>Run <b>build -ceZ</b>, or
use the macro <b>BLD</b>. This behavior invokes the Microsoft make routines
that produce log files called Buildxxx.log, and also Buildxxx.wrn and
Buildxxx.err if there are any warnings or errors. Where xxx stands for <b>fre</b>
or <b>chk</b> depending on the environment chosen. If the build succeeds, the
driver mars.sys and the generated inf file mars.inf will be placed in a platform specific subdirectory of your <b>%TargetPath%</b>
directory specified in the Sources file.<o:p></o:p></span></p>

<h4><span style='font-size:14.0pt;mso-bidi-font-size:12.0pt;font-family:Verdana'>Installing
the Sample<o:p></o:p></span></h4>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:Verdana;
color:black'>To install the bus driver on Windows XP and later operating systems: <o:p></o:p></span></p>

<ol start=1 type=1>
 <li class=MsoNormal style='color:black;mso-margin-top-alt:auto;mso-margin-bottom-alt:
     auto;mso-list:l1 level1 lfo5;tab-stops:list .5in'><span style='font-size:
     10.0pt;font-family:Verdana'>Copy mars.sys, mars.inf, kmdfsamples.cat & WDF Coinstaller (wdfcoinstallerMMmmm.dll) to a disk. <o:p></o:p></span></li>
 <li class=MsoNormal style='color:black;mso-margin-top-alt:auto;mso-margin-bottom-alt:
     auto;mso-list:l1 level1 lfo5;tab-stops:list .5in'><span style='font-size:
     10.0pt;font-family:Verdana'>Double-click the Add Hardware wizard in
     Control Panel. <o:p></o:p></span></li>
 <li class=MsoNormal style='color:black;mso-margin-top-alt:auto;mso-margin-bottom-alt:
     auto;mso-list:l1 level1 lfo5;tab-stops:list .5in'><span style='font-size:
     10.0pt;font-family:Verdana'>At the 'Welcome to the Add Hardware Wizard',
     click Next. <o:p></o:p></span></li>
 <li class=MsoNormal style='color:black;mso-margin-top-alt:auto;mso-margin-bottom-alt:
     auto;mso-list:l1 level1 lfo5;tab-stops:list .5in'><span style='font-size:
     10.0pt;font-family:Verdana'>Select 'Yes, I have already connected the
     hardware', then click Next. <o:p></o:p></span></li>
 <li class=MsoNormal style='color:black;mso-margin-top-alt:auto;mso-margin-bottom-alt:
     auto;mso-list:l1 level1 lfo5;tab-stops:list .5in'><span style='font-size:
     10.0pt;font-family:Verdana'>Select Add a new hardware device from the
     list, then click Next. <o:p></o:p></span></li>
 <li class=MsoNormal style='color:black;mso-margin-top-alt:auto;mso-margin-bottom-alt:
     auto;mso-list:l1 level1 lfo5;tab-stops:list .5in'><span style='font-size:
     10.0pt;font-family:Verdana'>Select Install the hardware that I manually
     select from a list(Advanced),' and then click next. <o:p></o:p></span></li>
 <li class=MsoNormal style='color:black;mso-margin-top-alt:auto;mso-margin-bottom-alt:
     auto;mso-list:l1 level1 lfo5;tab-stops:list .5in'><span style='font-size:
     10.0pt;font-family:Verdana'>Select Show All Devices, then click Next. <o:p></o:p></span></li>
 <li class=MsoNormal style='color:black;mso-margin-top-alt:auto;mso-margin-bottom-alt:
     auto;mso-list:l1 level1 lfo5;tab-stops:list .5in'><span style='font-size:
     10.0pt;font-family:Verdana'>Click 'Have Disk', make sure that 'A:\' is in
     the &quot;Copy manufacturer's files from:&quot; box, and click OK. <o:p></o:p></span></li>
 <li class=MsoNormal style='color:black;mso-margin-top-alt:auto;mso-margin-bottom-alt:
     auto;mso-list:l1 level1 lfo5;tab-stops:list .5in'><span style='font-size:
     10.0pt;font-family:Verdana'>Click on the desired entry, and then click
     Next. <o:p></o:p></span></li>
 <li class=MsoNormal style='color:black;mso-margin-top-alt:auto;mso-margin-bottom-alt:
     auto;mso-list:l1 level1 lfo5;tab-stops:list .5in'><span style='font-size:
     10.0pt;font-family:Verdana'>At 'The wizard is ready to install your
     hardware', click Next. <o:p></o:p></span></li>
 <li class=MsoNormal style='color:black;mso-margin-top-alt:auto;mso-margin-bottom-alt:
     auto;mso-list:l1 level1 lfo5;tab-stops:list .5in'><span style='font-size:
     10.0pt;font-family:Verdana'>Click Finish at 'Completing the Add/Remove
     Hardware Wizard.' <o:p></o:p></span></li>
</ol>
<br>
<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto'><span
style='font-size:10.0pt;font-family:Verdana;color:black'>Alternatively, you can
use the DEVCON.EXE from the DDK to install the driver programmatically.<o:p></o:p></span></p>

<p><b><span style='font-size:10.0pt;font-family:Verdana'>c:\&gt;DEVCON.EXE
INSTALL mars.inf "SD\vid_0388&pid_0000"</span></b><span style='font-size:10.0pt;font-family:
Verdana'><o:p></o:p></span></p>

<p><span style='font-size:10.0pt;font-family:Verdana'>The system copies the
mars.sys file to %systemroot%\system32\drivers directory and loads the
driver. <o:p></o:p></span></p>

<h3><span style='font-size:14.0pt;mso-bidi-font-size:13.5pt;font-family:Verdana'>CODE
TOUR<o:p></o:p></span></h3>

<h4><span style='font-family:Verdana'>File Manifest<o:p></o:p></span></h4>

<pre><u>File<span style='mso-tab-count:2'>              </span>Description<o:p></o:p></u></pre><pre><o:p>&nbsp;</o:p></pre>
<pre>ntddmars.h<span style='mso-spacerun:yes'>           </span>Header containing global definitions</pre>
<pre>mars.inx<span style='mso-spacerun:yes'>             </span>Device Installation File</pre>
<pre>mars.h<span style='mso-spacerun:yes'>               </span>Header containing driver specific definitions</pre>
<pre>mars.c<span style='mso-spacerun:yes'>               </span>Source code for driver functions</pre>
<pre>Sources<span style='mso-spacerun:yes'>              </span>Generic file for building the code sample.</pre>
<pre>makefile<span style='mso-spacerun:yes'>             </span>The file merely indirects to the real makefile that is shared by all the driver components of the windows Driver Kit.</pre>
<pre>makefile.inc<span style='mso-spacerun:yes'>         </span>The file stamps the inx file with kmdf version and generates the inf file.</pre>
<pre>sdiosample.htm<span style='mso-spacerun:yes'>       </span>Sample Tour documentation for this sample (this file).</pre>

<h3 style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><span
style='font-family:Verdana'><o:p>&nbsp;</o:p></span></h3>

<p class=MsoBodyText style='tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt'><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>

