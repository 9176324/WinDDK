<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1252">
<META NAME="Generator" CONTENT="Microsoft Word 97">
<TITLE>IOCTL</TITLE>
<META NAME="Template" CONTENT="C:\PROGRAM FILES\MICROSOFT OFFICE\OFFICE\html.dot">
</HEAD>
<BODY TEXT="#000000" LINK="#0000ff" VLINK="#800080" BGCOLOR="#ffffff" leftmargin="8">
<FONT FACE="Verdana"><H2><A NAME="MYSAMPLE">IOCTL</A> </H2>
<H3>SUMMARY</H3></FONT><FONT FACE="Verdana" SIZE=2><P>
This sample demonstrates the usage of four different types of IOCTLs (METHOD_IN_DIRECT, METHOD_OUT_DIRECT, METHOD_NEITHER, and METHOD_BUFFERED) supported by Windows, and how the user input & output buffer specified in the DeviceControl function is handled by the I/O subsystem and the driver in each case.<P>

The sample consists of a legacy device driver and a Win32 console mode test application. The test application opens a handle to the device exposed by the driver and and makes all four different DeviceIoControl calls one after another. To understand how the IRP fields are set the I/O manager, you should run the checked build versoin of the driver and see the debug output.<P>

This driver will work on Windows 2000, Windows XP and Windows Server 2003 operating systems. The build instructions given here applies to Windows 2000/XP/Server 2003 build environments. This has sample hasn't been tested on Windows 9x systems so it may or may not work.<P>

<B>This sample driver is not a PnP driver. This is a minimal driver meant to demonstrate an OS feature. Neither it nor its sample programs are intended for use in a production environment. Rather, they are intended for educational purposes and as a skeleton driver.</B><P>
<H3>BUILDING THE SAMPLE</H3></FONT><FONT FACE="Verdana" SIZE=2><P>
Click the Free Build Environment or Checked Build Environment icon under Development Kits program group to set basic environment variables. <P>

Change to the directory containing the sample source code, such as CD Src\General\ioctl. 
<P>
Run build -ceZ, or use the macro BLD. This command invokes the Microsoft make routines to build the components. If the build succeeds, you will find the driver, sioctl.sys, and the test application, ioctlapp.exe, in the i386 subdirectory of the %TARGETPATH% directory specified in the Sources file. If it fails you can find errors and warnings in the buildxxx.err and buildxxx.err respectively, where xxx is eithr chk or fre depending on the build environment. 

<P>

<H3>TESTING</h3></FONT><FONT FACE="Verdana" SIZE=2><P>
To test this driver, copy the test app, ioctlapp.exe, and the driver to the same directory, and run the application. The application will automatically load the driver if it's not already loaded and interact with the driver. When you exit the app, the driver will be stopped, unloaded and removed. 

<H3>RESOURCES</h3></FONT><FONT FACE="Verdana" SIZE=2><P>
For information about driver and hardware development, see <A HREF="http://www.microsoft.com/whdc">http://www.microsoft.com/whdc</A>.<P>
For the latest release of the Windows NT device driver kit, see <A HREF="http://www.microsoft.com/whdc/devtools/ddk">http://www.microsoft.com/whdc/devtools/ddk/default.mspx</A>.<P>
<H3>CODE TOUR</H3>
<H4>File Manifest</H4>
</FONT><U><PRE>File&#9;&#9;Description
</U>
Ioctl.htm&#9;Sample Tour documentation for this sample (this file).
Sources&#9;	Generic file that lists source files and all the build options.
Sioctl.c&#9;Source file of the sample driver.
Sioctl.h&#9;Header file for defining ioctls; included by driver and the test application.
Sioctl.ini&#9;.Ini file for setting up the registry to load the driver.
Testapp.c&#9;Source file of the test application.
Sioctl.rc&#9;Resource file that specify information such as file type, version, etc.
Makefile&#9;This file merely indirects to the real makefile that is shared by all the driver components of the Windows NT DDK.
 
</pre></FONT><P ALIGN="CENTER"><A HREF="#top"><FONT FACE="Verdana" SIZE=2>Top of page</FONT></A><FONT FACE="Verdana" SIZE=2> </P></FONT>
<TABLE CELLSPACING=0 BORDER=0 WIDTH=624>
<TR><TD VALIGN="MIDDLE" BGCOLOR="#00ffff" HEIGHT=2>
<P></TD>
</TR>
</TABLE>

<FONT FACE="MS Sans Serif" SIZE=1><P>&copy; 1998 Microsoft Corporation</FONT><FONT FACE="Verdana" SIZE=2> </P></FONT></BODY>
</HTML>
